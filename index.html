
<!DOCTYPE html>
<html>

<!-- Mirrored from powerline.coolmathgames.com/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 08 Oct 2024 22:05:22 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta charset="utf-8" />
    <meta name="title" content="powerline.io" />
    <meta name="keywords" content="powerlineio, powerline, io, game, games, web game, html5, fun, flash, snake, line, lines, tron">
    <meta name="description" content="powerline.io - Massive multiplayer online snake" />
    <meta property="og:title" content="powerline.io" />
    <meta property="og:description" content="powerline.io - Massive multiplayer online snake" />
    <meta property="og:url" content="http://powerline.io/" />
    <meta property="og:image" content="../powerline.io/images/thumbnail.png" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:type" content="website" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="css/mainb6f5.css?v=10" />
    <link rel="canonical" href="http://powerline.io/" />
    <link id="favicon" rel="icon" type="image/png" href="images/favicon.png" />
    <title>Powerline.io - Play it now at Coolmath-Games.com</title>

    <script src="lib/jquery-1.4.2.min.js"></script>
    <script src="lib/advertisement.js"></script>
    <script>
        var debug = false;
        var queryString = {};
        var adsense = true;
        (function () {
            var suffix = window.location.search;
            if (suffix.charAt(0) == '?')
                suffix = suffix.slice(1);
            var array = suffix.split('&');
            for (var i = 0; i < array.length; i++) {
                var suffixPart = array[i].split('=');
                var p2 = suffixPart[1];
                if (!p2) p2 = 1;
                queryString[suffixPart[0]] = p2;
            }
        })();

    </script>
</head>
<body data-feedly-mini="yes">
    <div id="ahya" style="position: absolute; width: 1000px; height: 700px; left: 0; right: 0; top: 0; bottom: 0; background-color: rgba(0,0,0,0.0); z-index: 2;">

        <canvas id="canvas"></canvas>
        <div class="basic-text" style="position:absolute;left:50%;top:45%;-ms-transform:translate(-50%,-50%);-webkit-transform:translate(-50%,-50%);">
            <div hidden class="basic-text nums" id="countdown" style="font-size:80px;opacity: 0;">3</div>
        </div>
        <div id="achievementNotification" style="display:none; position:absolute; left:0; right:0; bottom:60px;">
            <img src="images/achievement_holder_notification.png" style="position:absolute; left:0; right:0; top:0; bottom:0; margin:auto;" />
            <img class="achievementIcon" src="images/achievement_icon_placeholder.png" style="position:absolute; left:-190px; right:0; top:0; bottom:0; margin:auto;" />
            <div style="position:absolute; left:-60px; right:-130px; top:-30px; margin:0 50%;">
                <p class="achievementName" style="color:#F4FFFF; font-size:16px; font-weight:700; margin:0;">Achievement name</p>
                <p class="achievementDesc" style="color:#C4E2E2; font-size:12px; font-weight:700; line-height:normal; margin:2px 0;">Achievement description</p>
            </div>
            <img src="images/achievement_icon_check.png" style="position:absolute; left:0; right:-240px; top:0; bottom:-50px; margin:auto;" />
        </div>
        <div id="fps"></div>
        <div id="overlay" style="display:none; position: absolute; left: 0; right: 0; top: 0; bottom: 0; background-color: rgba(0,0,0,0.0); z-index: 2;">
            <div id="mainDialog" style="width:510px;height:215px;background-color:rgba(0,50,50,0.0);margin:10px auto;border-radius:15px;padding:5px 15px 5px 15px;position:absolute;top:17%;left:50%;transform-origin:top center;transform:translate(-50%,0%);-ms-transform:translate(-50%,0%);-ms-transform-origin:top center;-webkit-transform:translate(-50%,0%);-webkit-transform-origin:top center;">
                <img src="images/logo.png" style="position:absolute;top:-100%;left:50%;transform:translate(-50%,0%);-ms-transform:translate(-50%,0%);-webkit-transform:translate(-50%,0%);" />
                <div id="basePanel">
                    <div style="height:10px;"></div>
                    <div id="tips" class="basic-text"></div>
                    <div style="height:40px;"></div>
                    <form role="form">
                        <div class="form-group">
                            <div id="topGui" style="height:100px;">
                                <div id="nickInput" style="height:50px;">
                                    <center>
                                        <input readonly style="cursor: auto;" id="nick" type="text" class="form-control input-nick" maxlength="30" onkeydown="if (event.keyCode == 13){ clickPlay(document.getElementById('nick').value); return false;} return true;" autofocus />
                                        <a style="display:inherit;position:absolute;right: 60px;top: 70px" id="refreshButton" href="javascript:randomizeNicks();" class="btn-naked">
                                            <img id="refreshImg"
                                                 src="images/refresh.png"
                                                 onmouseover="this.src='images/refresh_mouseover.png'"
                                                 onmouseout="this.src='images/refresh.png'" />
                                        </a>
                                    </center>
                                </div>
                                <div id="mainMenuXpBar" style="position:absolute; left:8%; right:8%; top:150px; bottom:-100px">
                                    <img src="images/xp_container.png" style="position:absolute; left:75px; top:23px;" />
                                    <div id="mainMenuXpBarDiv" style="position:absolute; left:56px; top:4px; height:100px; max-width:74px; overflow:hidden; direction:rtl; z-index:0;">
                                        <img id="mainMenuXpBarImg" src="images/xp_meter.png" style="position:relative; top:11px;" />
                                        <img id="mainMenuXpBarParticles" src="images/xp_meter_particles.gif" style="display:none; position:relative; top:-37px; z-index:-1;" />
                                    </div>
                                    <img src="images/xp_circle.png" style="position:absolute; left:36px; top:-1px;" />
                                    <div style="display:flex; position:absolute; left:-14px; top:-17px; width:159px; height:101px; text-align:center; align-items:center;">
                                        <div id="mainMenuLevel" style="margin:auto; color:#FF33BB; text-shadow:#FF33BB 0 0 5px; font-size:26px;">
                                            1
                                        </div>
                                    </div>
                                </div>
                                <center>
                                    <div class="basic-text">
                                        <center><div style="font-size:28px; margin-top:35%; color: #e5ff05; text-shadow: #e5ff05 0 0 5px;">[ PRESS ENTER TO PLAY ]</div></center>
                                    </div>
                                </center>
                                <br clear="both" />
                            </div>
                            <div hidden id="topGuiConnecting" class="basic-text" style="height:84px; transform: translateY(30%);">
                                <h3><center>Connecting...</center></h3>
                            </div>
                            <div hidden id="roomFailed" style="height:90px;">
                                <div class="basic-text">
                                    <h4><center><div style="font-size:30px;">SERVER IS FULL!</div><br>CLICK CONTINUE TO JOIN ANOTHER SERVER.</center></h4>
                                </div>
                                <br><br>
                                <form role="form">
                                    <div class="form-group">
                                        <center>
                                            <button type="submit" id="continueButton" onclick="setContinue(); return false;" class="btn btn-play btn-primary"><div class="basic-text">CONTINUE</div></button>
                                        </center>
                                    </div>
                                </form>
                            </div>
                            <br>
                        </div>
                    </form>
                </div>
            </div>
            <div hidden id="statsPage" class="outlinedContainer" style="position:absolute; left:26%; right:26%; top:21%; color:#05FFFF;">
                <div style="display:flex; height:80px; text-align:center; align-items:center;">
                    <div style="margin:auto; font-size:16px; font-weight:800;">
                        <div id="endScreenMessage" style="color:#00C0C0;">ZAPPED BY</div>
                        <div id="endScreenMessageKiller">Player</div>
                    </div>
                </div>
                <div style="position:relative; margin-left:52px; font-size:14px; font-weight:800; z-index:1;">
                    <div class="endScreenStatLine">
                        <span>SCORE</span>
                        <span id="endScreenScore" class="endScreenStatLineRight" style="right:52px;">0</span>
                    </div>
                    <div class="endScreenStatLine">
                        <span>ZAPS: <span id="endScreenKills">0</span></span>
                        <span id="endScreenKillsXp" class="endScreenStatLineRight" style="right:52px;">0</span>
                    </div>
                    <div class="endScreenStatLine">
                        <span>BEST RANK: <span id="endScreenRank">0</span></span>
                        <span id="endScreenRankXp" class="endScreenStatLineRight" style="right:52px;">0</span>
                    </div>
                    <div id="endScreenBonusStatLine" class="endScreenStatLine" style="margin-left:-6px;">
                        <span id="endScreenBonusStatLineLabel" style="position:relative; left:6px;">BONUSES &amp; PENALTIES</span>
                        <span id="endScreenBonusStatLineXp" class="endScreenStatLineRight" style="right:52px;">0</span>
                        <img class="endScreenStatLineButton endScreenStatLineExpandButton" src="images/stats_plus.png"
                             onclick="openStatsPageDetails(0); return false;" />
                        <img class="endScreenStatLineButton endScreenStatLineCollapseButton" src="images/stats_minus.png"
                             onclick="closeStatsPageDetails(); return false;" />
                    </div>
                    <div id="endScreenAchievementsStatLine" class="endScreenStatLine" style="margin-left:-6px;">
                        <span style="position:relative; left:6px;">ACHIEVEMENTS</span>
                        <span id="endScreenAchievementsStatLineXp" class="endScreenStatLineRight" style="right:52px;">0</span>
                        <img class="endScreenStatLineButton endScreenStatLineExpandButton" src="images/stats_plus.png"
                             onclick="openStatsPageDetails(1); return false;" />
                        <img class="endScreenStatLineButton endScreenStatLineCollapseButton" src="images/stats_minus.png"
                             onclick="closeStatsPageDetails(); return false;" />
                    </div>
                    <div class="endScreenStatLine" style="margin-top: 25px;">
                        <span>XP GAINED</span>
                        <span id="endScreenTotalXp" class="endScreenStatLineRight" style="right:52px;">0</span>
                    </div>
                </div>
                <!--img id="endScreenNewbest" src="images/newbest.png" style="position:absolute;top:59%;left:98%;" /-->
                <div style="position:relative; height:78px; margin:12px;">
                    <img id="endScreenLevelParticles" src="images/xp_circle_particles.gif" width="400" height="120" style="display:none; position:absolute; left:-10px; top:-25px;" />
                    <img src="images/xp_container.png" style="position:absolute; left:75px; top:23px;" />
                    <div id="endScreenXpBarDiv" style="position:absolute; left:56px; top:4px; height:100px; max-width:74px; overflow:hidden; direction:rtl; z-index:0;">
                        <img id="endScreenXpBarImg" src="images/xp_meter.png" style="position:relative; top:11px;" />
                        <img id="endScreenXpBarParticles" src="images/xp_meter_particles.gif" style="display:none; position:relative; top:-37px; z-index:-1;" />
                    </div>
                    <div style="display:flex; position:absolute; left:-14px; top:-17px; width:159px; height:101px; text-align:center; align-items:center;">
                        <img id="endScreenLevelFrame" src="images/xp_circle.png" width="59" height="67" style="margin:auto;"/>
                    </div>
                    <div style="display:flex; position:absolute; left:-14px; top:-17px; width:159px; height:101px; text-align:center; align-items:center;">
                        <div id="endScreenLevel" style="margin:auto; color:#FF33BB; text-shadow:#FF33BB 0 0 5px; font-size:26px;">
                            1
                        </div>
                    </div>
                </div>
                <div style="display:flex; position:absolute; left:100%; margin-left:-10px; top:-40%; bottom:-40%; align-items:center; z-index:-1;">
                    <div class="outlinedContainer endScreenStatsDetails" style="display:none; margin:auto; padding:8px 12px 8px 22px; min-width:240px; font-size:13px; font-weight:800; line-height:18px;">
                        <div>
                            <div class="endScreenStatLine endScreenStatLinePositive">
                                <span class="endScreenStatLineLeft">BONUS</span>
                                <span class="endScreenStatLineRight">0</span>
                            </div>
                        </div>
                        <div style="position:relative; margin:10px 0 2px 0; margin-top:10px; font-size:16px">
                            <span class="endScreenStatLineLeft">TOTAL</span>
                            <span class="endScreenStatLineRight endScreenStatsDetailsTotal">0</span>
                        </div>
                    </div>
                </div>
                <div class="basic-text" style="position:absolute; width:100%; bottom:-64px; text-align:center; font-size:24px; color:#e5ff05; text-shadow:#e5ff05 0 0 5px;">
                    [ PRESS ENTER TO PLAY ]
                </div>
            </div>
            <div id="achievementsPage" class="outlinedContainer" style="display:none; position:absolute; left:16%; right:16%; top:20%; bottom:9%; z-index:2">
                <p style="text-align:center; color:#05FFFF; font-size:21px; font-weight:800; margin:5px;">ACHIEVEMENTS</p>
                <p id="achievementsEarned" style="position:absolute; left:16px; top:8px; color:#05FFFF; font-size:15px; font-weight:800; margin:5px;">0 of 1 Earned</p>
                <button type="submit" class="btn-naked" style="position:absolute; top:-37px; right:-37px; padding:15px;" onclick="closeAchievements(); return false;">
                    <img src="images/button_close.png" />
                </button>
                <div class="scroller" style="position:absolute; left:13px; right:17px; top:45px; bottom:20px; overflow: auto;">
                    <div class="achievementCard achievementCardLocked" style="float:left; position:relative; width:280px; height:90px; margin:5px 8px;">
                        <img class="achievementIcon" src="images/achievement_icon_placeholder.png" style="position:absolute; left:1px; top:4px;" />
                        <div style="position:absolute; left:73px; top:4px; width: 190px; height: 80px;">
                            <p class="achievementName" style="font-size:13px; font-weight:800; margin:0;">Achievement name</p>
                            <p class="achievementDesc" style="font-size:12px; font-weight:700; line-height:normal; margin:0;">Achievement description</p>
                        </div>
                        <img class="achievementCheck" src="images/achievement_icon_check.png" style="position:absolute; left:244px; top:52px; margin:auto;" />
                        <div class="achievementProgressHolder" style="display:none; position:absolute; left:73px; bottom:2px; width:190px;">
                            <div class="achievementProgressSlider" style="display:none; position:absolute; left:-8px; top:-8px; width:6px;"></div>
                            <p class="achievementProgressText"
                               style="position:absolute; left:-8px; top:-7px; width:190px; text-align:center; color:#FFFFFF; font-size:11px;">
                                0 / 1
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <footer hidden id="soundDiv" style="z-index:1000; position:absolute; bottom:0; left:0; padding:25px;">
                <button type="submit" id="muteButton" onclick="toggleSound(); return false;" class="btn-naked">
                    <img id="soundOnImg"
                         src="images/sound_on.png"
                         onmouseover="this.src='images/sound_on_mouseover.png'"
                         onmouseout="this.src='images/sound_on.png'" />
                    <img id="soundOffImg"
                         style="display:none;"
                         src="images/sound_off.png"
                         onmouseover="this.src='images/sound_off_mouseover.png'"
                         onmouseout="this.src='images/sound_off.png'" />
                </button>
            </footer>
            <footer style="z-index:1000; position:absolute; bottom:0; right:0; padding:10px;">
                <a class="btn-naked" href="javascript:toggleAchievements();">
                    <img id="achievementsClosedImg"
                         src="images/achievements.png"
                         onmouseover="this.src='images/achievements_mouseover.png'"
                         onmouseout="this.src='images/achievements.png'" />
                    <img id="achievementsOpenImg" src="images/achievements_selected.png"
                         style="display:none;"
                         onmouseover="this.src='images/achievements_mouseover.png'"
                         onmouseout="this.src='images/achievements_selected.png'" />
                </a>
            </footer>
            <footer hidden id="copyLink" style="margin:8px">
                <a href="javascript:copyRoomLink();">
                    <img src="images/playfriends.png"
                         onmouseover="this.src='images/playfriends_mouseover.png'"
                         onmouseout="this.src='images/playfriends.png'" />
                </a>
            </footer>
            <footer hidden id="copyLinkBox" class="leftBox" style="width:430px;">
                <div style="line-height:50%;"><br></div>
                <font style="font-weight:bold;font-size:15px;" class="basic-text2"><center>SHARE THIS LINK WITH YOUR FRIENDS!</center></font>
                <div style="line-height:50%;"><br></div>
                <center>
                    <div id="linkInput" style="height:43px;width:95%;">
                        <input id="roomlinkInput" class="linkInput form-control input-copylink" readonly style="cursor: text;" />
                    </div>
                </center>

                <div hidden id="safariTooltip" style="width:160px;height:20px;background-color:rgba(0,0,0,0.6);margin:10px auto;border-radius:5px;padding:5px 15px 5px 15px;position:relative;top:0%;left:0%;transform-origin:top center;transform:translate(0%,0%);-ms-transform:translate(0%,0%);-ms-transform-origin:top center;-webkit-transform:translate(0%,-30%);">
                    <font style="position:relative;top:-5px;font-weight:bold;font-size:13px;color:#FFFFFF;">Press ⌘+C to Copy!</font>
                </div>

                <button id="copyButton" type="submit" onclick="setCopy(); return false;" class="btn btn-copy btn-primary basic-text2">COPY</button>

                <div style="line-height:50%;"><br></div>
            </footer>
        </div>
    </div>

    <div hidden id="overlay2" style="position: absolute; left: 0; right: 0; top: 0; bottom: 0; background-color: rgba(0,100,100,0.25); z-index: 2;">
        <div style="width:280px;height:180px;background-color:rgba(0,0,0,0.85);margin:10px auto;border-radius:15px;padding:5px 15px 5px 15px;position:absolute;top:35%;left:50%;transform-origin:top center;transform:translate(-50%,0%);-ms-transform:translate(-50%,0%);-ms-transform-origin:top center;-webkit-transform:translate(-50%,0%);-webkit-transform-origin:top center;">
            <center>
                <font face="Arial Black, Arial, sans-serif" style="position:relative;top:30px;font-weight:bold;font-size:28px;color:#00FFFF;text-shadow: #00FFFF 0 0 5px;">LINK COPIED!</font>
                <img id="copycheckimage" src="images/copycheck.png" style="position:relative;top:43px;" />
            </center>
        </div>
    </div>

    <div id="splashscreen" style="position: absolute; width: 1000px; height: 700px; left: 0; right: 0; top: 0; bottom: 0; background-color: #242424; z-index: 2;">
        <img src="images/splash.png" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);-webkit-transform:translate(-50%,-50%);" />
    </div>

    <script src="lib/modernizr-custom.js"></script>
    <script src="lib/Stats.js"></script>
    <script src="lib/howler.min.js"></script>
    <script>
(function(l,y,h){function db(){return 11==(new Date).getMonth()}function Ta(){try{return l.self!==l.top}catch(a){return!0}}function O(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function Vb(){var a=-1<navigator.userAgent.indexOf("Chrome"),c=-1<navigator.userAgent.indexOf("Safari");a&&c&&(c=!1);return c}function Kc(){Ja=3;Wb(Ja);h("#countdown").show();Xb=setInterval(function(){Wb(Ja)},1E3)}function Wb(a){h("#countdown")[0].innerHTML=Ja;0==Ja&&(h("#countdown").hide(),clearInterval(Xb),
n.sendNick(Yb));h("#countdown")[0].classList.remove("nums");void h("#countdown")[0].offsetWidth;h("#countdown")[0].classList.add("nums");Ja--}function Zb(){h("#copycheckimage").hide();h("#copyLink").show();h("#copyLinkBox").hide();h("#overlay2").fadeIn(200);setTimeout(function(){h("#copycheckimage").fadeIn(300)},200);setTimeout(function(){h("#overlay2").fadeOut(200);h("#nick").focus()},1E3);eb=!1}function Lc(){n&&n.disconnect()}function Bb(){h("#overlay").hide();T=!1}function Mc(){h("#overlay").fadeIn(500);
la&&h("#nick").focus();0<=Q&&Y&&n.hasConnection&&(h("#basePanel").hide(),M.openStatsPage());0>Q&&(W.initSpeedupTutorial(),W.fadeOutGame())}function $b(){T=!0;L||(B=null);setTimeout(Mc,1E3)}function ac(){0<=Q&&Y&&(bc||(h("#overlay").css({"background-color":"rgba(0,0,0,0.4)"}),bc=!0),Ka++,2<Ka&&(Ka=0),nextTipID=Ka,La=!0);setTimeout(ac,2500)}function cc(a,c){var g=Cb(a,c,ea.x,ea.y);return Math.max(0,Math.min(1,1-g/400))}function fb(a){switch(a){case 1:return{x:0,y:-1};case 2:return{x:-1,y:0};case 4:return{x:1,
y:0};case 3:return{x:0,y:1}}return b2Vec2(0,0)}function ha(a,c,g,d){a-=g;c-=d;return Math.sqrt(a*a+c*c)}function gb(a,c){var g=Math.sqrt(a*a+c*c);return{x:a/g,y:c/g}}function hb(a,c){for(var g=a.getUint8(c),d=a.getUint8(c+1);;){var k=a.getUint16(c,!0);c+=2;if(0==k)break}return{nick:ib[g]+" "+jb[d],offset:c}}function Cb(a,c,g,d){return Math.sqrt((g-a)*(g-a)+(d-c)*(d-c))}function Ma(a,c,g){var d=D.getBounds();return a+g>=d[0].x&&a-g<=d[1].x&&c+g>=d[0].y&&c-g<=d[1].y?!0:!1}function Db(a,c,g){return a<
c?c:a>g?g:a}function wa(a,c,g,d){a&&(this._size=a);c&&(this._color=c);this._stroke=!!g;d&&(this._strokeColor=d)}function Ua(a){return""==a?"<Unnamed>":a}function Eb(a,c,g,d,k,f){f/=2;a.beginPath();a.moveTo(c,g+f);a.lineTo(c,g+k-f);a.quadraticCurveTo(c,g+k,c+f,g+k);a.lineTo(c+d-f,g+k);a.quadraticCurveTo(c+d,g+k,c+d,g+k-f);a.lineTo(c+d,g+f);a.quadraticCurveTo(c+d,g,c+d-f,g);a.lineTo(c+f,g);a.quadraticCurveTo(c,g,c,g+f);a.closePath();a.fill()}function Nc(a,c,g,d,k,f){f/=2;a.beginPath();a.moveTo(c,g+
f);a.lineTo(c,g+k);a.lineTo(c+d,g+k);a.lineTo(c+d,g+f);a.quadraticCurveTo(c+d,g,c+d-f,g);a.lineTo(c+f,g);a.quadraticCurveTo(c,g,c,g+f);a.closePath();a.fill()}function dc(a,c,g){var d=a*Math.cos(g)-c*Math.sin(g);a=c*Math.cos(g)+a*Math.sin(g);return{x:d,y:a}}var N=!1,Fb=l.location.href.split("index.html"),Na=Fb[2],ec=l.location!=l.parent.location?y.referrer:y.location.href,kb=ec,lb=null,mb=ec.split("?");if(0<mb.length&&(kb=mb[0],1<mb.length))for(var fc=mb[1].split("&"),Gb=0;Gb<fc.length;Gb++){var gc=fc[Gb].split("=");
queryString[gc[0]]=gc[1]}var kb="https://www.coolmathgames.com/0-powerline-io",Va=null,Va=-1!=navigator.userAgent.indexOf("Edge")?2:-1!=navigator.userAgent.indexOf("Firefox")?0:-1!=navigator.userAgent.indexOf("MSIE")||1==!!y.documentMode?1:3;1!=Va&&h("#soundDiv").show();queryString.r&&(lb=queryString.r);queryString.d&&(N=!0);StrEndsWith=function(a,c){return-1!==a.indexOf(c,a.length-c.length)};StrEndsWith(Na,"coolmathgames.com")||"localhost"==Na||(l.location.href="https://coolmathgames.com/");Ta()||
(l.location.href="https://www.coolmathgames.com/0-powerline-io");Date.now||(Date.now=function(){return(new Date).getTime()});var Oc=Na.split(".");lastPart=Fb[Fb.length-1];var hc=Oc.length,Hb="https:"==l.location.protocol,P,I,ic="",Da=1E3/30*3,qa,jc=0,kc=0,ea={x:0,y:0},fa=1600,ia=5E3,xa=0,ya=0,nb=1.4,lc=1,mc=100,Ib=20,ma,Z,L=!1,la=!0,Jb=!1,aa=0,Kb=0,T=!0,ob=0,Lb=1,nc=!1,s=1,Mb=0,sa=!0,Nb=!1,pb=1.2,Ob=nb,Pb=!1,oc=!1,qb=0,za=0,Q=l.localStorage.killCount;if(void 0==Q||"undefined"==Q)Q=0;var Pc=Q,Wa=0,
Xa=!1,bc=!1,Y=!1,rb=!1,W,U,t,n,z={},B,V=0,D,R,Qb,sb,Rb,r,M,ra=0,pc=0,Ya=0,Za=0,tb,ub,vb,wb,qc=0,xb=0,Aa=1,eb=!1,yb=110,Sb=!0,rc=0,sc=40,F,S=1,ga=l.localStorage.muteVol;if(void 0==ga||"undefined"==ga)ga=1;var Oa=0,Ba=l.localStorage.arrows,ta=l.localStorage.speedUpTut;ta||(ta=0);var ib="Awesome Formidable Exalted Colorful Frantic Majestic Exuberant Terrible Impressive Adorable Alert Amusing Bored Brave Calm Carefree Careless Chilly Clever Clumsy Cranky Crazy Excited Fantastic Foolish Friendly Fussy Fuzzy Generous Glowing Great Lumpy Messy Mighty Peppy Nimble Blithering Optimistic Plump Polite Proud Quick Quiet Rude Rusty Shining Silly Sizzling Sleepy Slimy Sloppy Smooth Sparkling Speedy Splendid Starving Steaming Stinky Strict Sturdy Surprised Tough Tricky Wild Wise Wonderful Worried Vigorous Delightful Haunted Colossal Vivacious Infuriating Rebellious Slippery Vengeful Fierce Maniacal Affluent Decrepit Glamorous Opulent Saucy Calamitous Egregious Feckless Insidious Irksome Judicious Nefarious Pernicious Petulant Tenacious Famous Flabbergasted Feral Sinister Fresh Adventurous Spoony Noisy Whimsical Amazing Delicate Hairless Classy Gangly Disguised Juicy Ancient Frosty Savage Fiery Enraged Surly Dastardly Cantankerous Freedom Hazardous Dramatic Victory Boisterous Simple Feisty".split(" "),
jb="Captain;Pilot;Commander;Squaddie;Scout;Turtle;Fox;Hawk;Falcon;Eagle;Jester;Joker;Potato;Sauce;Ace;Flyer;Driver;Turkey;Chicken;Donkey;Goat;Llama;Antelope;Defender;Weasel;Hedgehog;Koala;Wolf;Groundhog;Stranger;Wolverine;Honey Badger;Chameleon;Cook;Hippie;Boss;Goose;Crawdad;Ham Sandwich;Toaster;Jackhammer;Grandma;Hot Dog;Spoon;Salt Shaker;Wizard;Waistcoat;Shovel;Unicorn;Pinecone;Ninja;Samurai;Cowboy;Buccaneer;Vampire;Werewolf;Pirate;Ogre;Princess;Mentor;Fool;Cactus;Bigfoot;Farmer;Knight;Ghost;Towel;BLT;Sorceror;Dinosaur;Disaster;Baby;Phoenix;Detective;Investigator;Eyeball;Hamster;Toad;Wombat;Worm;Hare;Zombie;Mutant;Mime;Sheriff;Concoction;Toast;Lollipop;Pancake;Milkshake;Plumber;Chainsaw;Ice Cream;Penguin;Hammer;Criminal".split(";"),
Pa=0,Qa=0,tc=99,uc=0,Qc="LOL;EASY!;OOPS!;I DARE YOU!;GOTCHA!;RUN!;TEAM?;YES!;NO!;KILL THE KING!".split(";");!ta&&3<Q&&(ta=1,l.localStorage.speedUpTut=ta);var $a=!1;"true"==l.localStorage.lq&&(sa=!1);var Ra=null,vc=function(){var a="",c=81;Hb&&(a="s",c=444);h.get("http"+a+"://powerline-master.coolmathgames.com:"+c+"/cc",function(a){Ra=a.substring(0,2);l.localStorage.wingsCC=Ra;l.localStorage.wingsCCTime=+new Date;N&&console.log("Fetched new country code: "+Ra)},"text")};(function(){if(void 0==l.localStorage.wingsCCTime||
void 0!=l.localStorage.wingsCC&&2!=l.localStorage.wingsCC.length)N&&console.log("Need to fetch new country code"),vc();else{var a=+new Date-l.localStorage.wingsCCTime;N&&console.log("Time CC Delay: "+a);288E5<a?(N&&console.log("More than 8 hours passed. Fetching new CC"),vc()):(Ra=l.localStorage.wingsCC,N&&console.log("Reusing last CC: "+Ra))}})();var Tb=function(){aa=+new Date;var a=0;0<Kb&&(a=aa-Kb);Kb=aa;W.update(a);W.draw(a);l.requestAnimationFrame&&l.requestAnimationFrame(Tb);Jb&&(Jb=!1)},Rc=
function(){I=new Stats;I.setMode(1);var a=y.getElementById("canvas");I.domElement.style.position="absolute";I.domElement.style.left=.25*a.width+"px";I.domElement.style.top=a.height-18-30+"px";y.getElementById("fps").appendChild(I.domElement);P=new Stats;P.domElement.style.position="absolute";P.domElement.style.left=.25*a.width-100+"px";P.domElement.style.top=a.height-18-30+"px";y.getElementById("fps").appendChild(P.domElement);setInterval(function(){P.update()},1E3/60);I.domElement.style.visibility=
"hidden";P.domElement.style.visibility="hidden"};y.body.onselectstart=function(){return!1};var Yb;l.clickPlay=function(a){if(!this.achievementsOpen){if(Ta()&&parent){var c=r.currentLevel()+1,c=(10>c?"0":"")+c+((10>Q?"00":100>Q?"0":"")+Q);l.parent.postMessage(JSON.stringify({eventType:"gameEvent",key:"start",value:c}),"*")}W.clearSpeedupTutorial();n.hasConnection?L?Bb():(l.localStorage.nickIndexes=[Pa,Qa],Mb++,qa.mouseMoved=!1,Bb(),Yb=a,Kc(),6>Mb&&R&&0==Mb%3&&R.showTip("Press 'M' to Toggle Sounds",
4E3),nc&&(h("#continueTop").hide(),h("#continueBR").hide(),h("#continue").hide(),h("#nickInput").show(),h("#skinPanel").hide(),h("#howto").show(),h("#beta").show(),nc=!1)):(h("#topGui").hide(),h("#topGuiConnecting").show())}};var Ja,Xb;l.setSpectate=function(a){};l.setContinue=function(){h("#topGui").show();h("#roomFailed").hide();lb=null;n.getServerAndConnect()};l.copyRoomLink=function(){h("#copyLink").hide();h("#copyLinkBox").show();var a=h("#roomlinkInput")[0];a.value=kb+"?r="+n.roomID;eb=!0;Vb()&&
(h("#copyButton")[0].childNodes[0].data="Close",h("#safariTooltip").show());setTimeout(function(){a.setSelectionRange(0,a.value.length);a.select();a.focus()},100)};l.setCopy=function(){var a=h("#roomlinkInput")[0];a.value=kb+"?r="+n.roomID;a.setSelectionRange(0,a.value.length);a.select();a.focus();if(Vb())h("#copyLinkBox").hide(),h("#copyLink").show(),eb=!1;else{try{y.execCommand("copy")}catch(c){}Zb()}};l.clickNoNames=function(a){Nb=!Nb;a.checked=Nb};var wc=l.navigator.userAgent;(-1<wc.indexOf("MSIE ")||
-1<wc.indexOf("Trident/index.html"))&&h("#sndIcon").hide();var zb;l.onblur=function(){N||(zb=setTimeout(Lc,3E5));la=!1;S=0;for(var a in z){var c=z[a];if(1==c.snake)c.onBlur()}};l.onfocus=function(a){if(!a||a.target==l){zb&&(clearTimeout(zb),zb=null);Jb=la=!0;for(var c in z)z[c].resume();!n||n.hasConnection||Ta()?T&&h("#nick").focus():n.getServerAndConnect();1==ga&&(S=1)}};l.openStatsPageDetails=function(a){M.openStatsPageDetails(a)};l.closeStatsPageDetails=function(){M.closeStatsPageDetails()};var Ca=0,Ka=
0,La=!1;setInterval(function(){if(T){var a=h("#tips")[0],c=.5*Math.PI;Ca+=.3;Ca>c&&0==La&&(Ca=c);c=(Math.sin(Ca)+1)/2;if(Ca>1.5*Math.PI){Ka=nextTipID;Ca-=2*Math.PI;La=!1;var g;switch(Ka){case 0:g="GET CLOSE TO OTHER SNAKES TO BOOST";break;case 1:g="CROSS OTHER PLAYERS";break;default:g="EAT TO GROW"}a.innerHTML=g}a.style.opacity=Math.sqrt(c,5)}},50);tips.innerHTML="GET CLOSE TO OTHER SNAKES TO BOOST";ac();l.onbeforeunload=function(){if(L)return"Are you sure you want to quit?"};y.oncontextmenu=function(){return!1};
l.toggleSound=function(){1==ga?(S=ga=0,h("#soundOffImg").show(),h("#soundOnImg").hide(),R&&R.showTip("Sounds Disabled",3E3)):0==ga&&(S=ga=1,h("#soundOnImg").show(),h("#soundOffImg").hide(),R&&R.showTip("Sounds Enabled",3E3));l.localStorage.muteVol=ga};var Ea=0;l.randomizeNicks=function(){Pa=parseInt(Math.random()*ib.length);Qa=parseInt(Math.random()*jb.length);h("#nick")[0].value=ib[Pa]+" "+jb[Qa];Ea+=180;h("#refreshButton").css({transform:"rotate("+Ea+"deg)","-ms-transform":"rotate("+Ea+"deg)","-moz-transform":"rotate("+
Ea+"deg)","-webkit-transform":"rotate("+Ea+"deg)","-o-transform":"rotate("+Ea+"deg)"})};var Sa=!1;l.openAchievements=function(){Sa||(M.openAchievementsPage(),h("#achievementsOpenImg").show(),h("#achievementsClosedImg").hide(),Sa=!0)};l.closeAchievements=function(){Sa&&(M.closeAchievementsPage(),h("#achievementsClosedImg").show(),h("#achievementsOpenImg").hide(),Sa=!1)};l.toggleAchievements=function(){Sa?closeAchievements():openAchievements()};setTimeout(function(){h("#splashscreen").fadeOut(500,function(){setTimeout(function(){M.animateMainMenuXpBar()},
500)})},500);0==ga&&(ga=1,toggleSound());y.getElementById("overlay").onmousedown=function(a){return a.target==h("#nick")[0]?!0:!1};if(l.localStorage.nickIndexes){var xc=l.localStorage.nickIndexes.split(","),Pa=xc[0],Qa=xc[1];h("#nick")[0].value=ib[Pa]+" "+jb[Qa]}else l.randomizeNicks();var yc="'proxima-nova-1','proxima-nova-2', Arial Black";0==Va&&(yc="Arial");wa.prototype={_value:"",_color:"#000000",_stroke:!1,_strokeColor:"#000000",_strokeWidth:3,_size:16,_canvas:null,_ctx:null,_dirty:!1,_scale:1,
_font:"px "+yc,_usingRoundedFrame:!1,_hmargin:0,_vmargin:-1,_margin:6,_frameOpacity:.3,_shadowBlur:0,_roundedFrameStyle:"#006666",_addTop:0,_minWidth:0,setAddTop:function(a){a!=this._addTop&&(this._addTop=a,this._dirty=!0)},setMinWidth:function(a){a!=this._minWidth&&(this._minWidth=a,this._dirty=!0)},setFont:function(a){this._font!=a&&(this._font=a,this._dirty=!0)},setSize:function(a){this._size!=a&&(this._size=a,this._dirty=!0)},setScale:function(a){this._scale!=a&&(this._scale=a,this._dirty=!0)},
setColor:function(a){this._color!=a&&(this._color=a,this._dirty=!0)},setStroke:function(a){this._stroke!=a&&(this._stroke=a,this._dirty=!0)},setShadowBlur:function(a){this._shadowBlur!=a&&(this._shadowBlur=a,this._dirty=!0)},setStrokeWidth:function(a){this._strokeWidth!=a&&(this._strokeWidth=a,this._dirty=!0)},setStrokeColor:function(a){this._strokeColor!=a&&(this._strokeColor=a,this._dirty=!0)},setValue:function(a){a!=this._value&&(this._value=a,this._dirty=!0)},setHMargin:function(a){a!=this._hmargin&&
(this._hmargin=a,this._dirty=!0)},setVMargin:function(a){a!=this._vmargin&&(this._vmargin=a,this._dirty=!0)},setMargin:function(a){a!=this._margin&&(this._margin=a,this._dirty=!0)},setUsingRoundedFrame:function(a){a!=this._usingRoundedFrame&&(this._usingRoundedFrame=a,this._dirty=!0)},setRoundedFrameOpacity:function(a){a!=this._frameOpacity&&(this._frameOpacity=a,this._dirty=!0)},setRoundedFrameStyle:function(a){a!=this._roundedFrameStyle&&(this._roundedFrameStyle=a,this._dirty=!0)},render:function(){null==
this._canvas&&(this._canvas=y.createElement("canvas"),this._ctx=this._canvas.getContext("2d"));if(this._dirty){this._dirty=!1;var a=this._canvas,c=this._ctx,g=this._value,d=this._scale,k=this._size,f="Bold "+k+this._font;c.font=f;var e=c.measureText(g).width,b=0;e<this._minWidth&&(b=this._minWidth-e,e=this._minWidth);var k=k-.1*k,v=this._margin;this._shadowBlur>v&&(v=this._shadowBlur);a.width=(e+2+2*v)*d;a.height=(k+2*v+this._addTop)*d;c.font=f;c.textBaseline="middle";c.scale(d,d);c.globalAlpha=1;
this._usingRoundedFrame&&(c.fillStyle=this._roundedFrameStyle,c.globalAlpha=this._frameOpacity,Eb(c,0,0,a.width,a.height,30),c.globalAlpha=1);a=v+b/2;k=v+this._addTop+k/2;c.fillStyle=this._color;this._stroke&&(c.lineJoin="round",c.lineWidth=this._strokeWidth,c.strokeStyle=this._strokeColor,c.strokeText(g,a,k));0<this._shadowBlur&&(c.shadowBlur=this._shadowBlur,c.shadowColor=this._strokeColor);c.fillText(g,a,k)}return this._canvas}};var Sc=function(){this.loaded=!1;this.onLoad=null;this.spriteSheetLoaded=
!1;this.gameSheet;this.frames={};this.skullRedGlow=this.skullDarkBlueGlow=this.skullPurpleGlow=this.skullRed=this.skullDarkBlue=this.skullPurple=this.bgGrid=this.boostImage=this.keysImage=null;this.loadGameSpritesheet=function(){this.gameSheet=new Image;this.gameSheet.src="images/sheet30f4.png?v=3";this.gameSheet.onload=function(){t.loadGameSpritesheetFrames();t.spriteSheetLoaded=!0;t.loadPatterns();t.skullDarkBlue=t.frames.skullbase.renderTintedFrame("#2a9de3");t.skullDarkBlueGlow=t.frames.skullglow.renderTintedFrame("#1931d6");
t.skullPurple=t.frames.skullbase.renderTintedFrame("#c12ee5");t.skullPurpleGlow=t.frames.skullglow.renderTintedFrame("#0000FF");t.skullRed=t.frames.skullbase.renderTintedFrame("#ff2222");t.skullRedGlow=t.frames.skullglow.renderTintedFrame("#552255");t.loaded=!0;t.onLoad()}};this.loadPatterns=function(){var a=t.frames.grid.renderToCanvas();t.bgGrid=W.context.createPattern(a,"repeat")};this.loadGameSpritesheetFrames=function(){for(var a=gameSheetInfo.length,c=0;c<a;c++){var g=gameSheetInfo[c],d=new Ab;
d.setFrameInfo(g,this.gameSheet);this.frames[g[0]]=d}};this.load=function(a){this.onLoad=a;this.loadGameSpritesheet();this.keysImage=new Image;this.keysImage.src="images/arrows.png";this.keysImage.onload=function(){};this.boostImage=new Image;this.boostImage.src="images/close-to-boost-w.png";this.boostImage.onload=function(){}};this.loadTintImage=function(a,c,g){var d=y.createElement("canvas"),k=d.getContext("2d"),f=a.width,e=a.height;d.width=f;d.height=e;var b=y.createElement("canvas");b.width=f;
b.height=e;f=b.getContext("2d");f.fillStyle=g;f.fillRect(0,0,b.width,b.height);f.globalCompositeOperation="destination-atop";f.drawImage(a,0,0);k.globalAlpha=1;k.drawImage(b,0,0);c(d)}},Tc=function(){var a=this;this.mouseMoved=!1;this.direction=1;var c=0,g=0;a.mousedown=function(a){T?M.isShowingStatsPage()?(h("#basePanel").show(),h("#nick").focus(),h("#basePanel").hide()):h("#nick").focus():(g++,2<g&&(Ba=void 0,g=c=0),jc=a.clientX,kc=a.clientY)};a.keydown=function(d){32!=d.keyCode&&38!=d.keyCode&&
87!=d.keyCode&&37!=d.keyCode&&65!=d.keyCode&&40!=d.keyCode&&83!=d.keyCode&&39!=d.keyCode&&68!=d.keyCode||d.preventDefault();if(T&&(d.metaKey||d.ctrlKey)&&65==d.keyCode){var g=h("#nick")[0];g.setSelectionRange(0,g.value.length)}if(Sa&&27==d.keyCode)closeAchievements();else if(g=M.isShowingStatsPage(),T&&g)13==d.keyCode||32==d.keyCode?clickPlay(l.localStorage.nick):27==d.keyCode&&(M.closeStatsPage(),h("#basePanel").show(),h("#nick").focus());else if(67==d.keyCode&&T&&eb)setTimeout(function(){Zb()},
10);else if(!T){32==d.keyCode&&void 0!=Ba&&0!=Ba&&(Oa=1E3);73==d.keyCode&&(rb?(I.domElement.style.visibility="hidden",P.domElement.style.visibility="hidden"):(I.domElement.style.visibility="visible",P.domElement.style.visibility="visible",n.ping()),rb=!rb);if(N)if(75==d.keyCode)n.leave();else if(76==d.keyCode)Xa||n.bigPicture(),D.x=0,D.y=0,D.zoom=.3599,r.signalWasKilled(null),L=!1,Xa=!0;else if(88!=d.keyCode&&67==d.keyCode){Object.keys(z);Object.keys(z);var f=g=0,e;for(e in z){var b=z[e];b.snake&&
(g+=b.getTestValue(),f++)}console.log("Snakes: "+f+", Sum: "+g);console.log("Arena Size: "+ia/10)}B?(e=B.x,g=B.y,f=yb,d.preventDefault(),38==d.keyCode||87==d.keyCode?1!=a.direction&&3!=a.direction&&0!=a.direction&&(a.direction=1,a.turn(a.direction,e,g,f,0)):37==d.keyCode||65==d.keyCode?2!=a.direction&&4!=a.direction&&0!=a.direction&&(a.direction=2,a.turn(a.direction,e,g,f,0)):40==d.keyCode||83==d.keyCode?3!=a.direction&&1!=a.direction&&0!=a.direction&&(a.direction=3,a.turn(a.direction,e,g,f,0)):39!=
d.keyCode&&68!=d.keyCode||4==a.direction||2==a.direction||0==a.direction||(a.direction=4,a.turn(a.direction,e,g,f,0))):Xa&&(e=.01,d.shiftKey&&(e=.1),38==d.keyCode?D.zoom+=e:40==d.keyCode&&(D.zoom-=e),console.log(D.zoom),console.log(ia/10));70==d.keyCode?(y.fullscreenElement||y.mozFullScreenElement||y.webkitFullscreenElement||y.msFullscreenElement?y.exitFullscreen?y.exitFullscreen():y.msExitFullscreen?y.msExitFullscreen():y.mozCancelFullScreen?y.mozCancelFullScreen():y.webkitExitFullscreen&&y.webkitExitFullscreen():
y.documentElement.requestFullscreen?y.documentElement.requestFullscreen():y.documentElement.msRequestFullscreen?y.documentElement.msRequestFullscreen():y.documentElement.mozRequestFullScreen?y.documentElement.mozRequestFullScreen():y.documentElement.webkitRequestFullscreen&&y.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),R.clearTip()):77==d.keyCode?toggleSound():90==d.keyCode&&N&&L&&(Pb=!Pb);2<c&&(Ba=1,l.localStorage.arrows=Ba)}};a.keyup=function(a){};this.turn=function(a,
g,f,e,b){c++;Sb?(g=+new Date,f=g-rc,rc=g,30>f&&(e+=30),e=B.addTurnPoint(a,e),g=10*e.x,f=10*e.y,n.sendTurnPoint(a,1==a||3==a?g/10:-f/10)):n.sendDirection(a)};this.addListeners=function(){y.addEventListener("mousedown",a.mousedown,!1);y.addEventListener("keydown",a.keydown,!1);y.addEventListener("keyup",a.keyup,!1)}},Uc=function(){var a=[],c=[];this.draw=function(a){for(var d=[],k=c.length,f=0;f<k;f++){var e=c[f];e.a-=.1;0<e.a?(a.save(),a.beginPath(),a.fillStyle="rgba(255,0,0,1.0)",a.globalAlpha=e.a,
a.arc(e.x,e.y,50*Math.sqrt(1-e.a),0,2*Math.PI),a.closePath(),a.fill(),a.restore()):d.push(e)}for(a=0;a<d.length;a++)k=c.indexOf(d[a]),c.splice(k,1);d.length=0};this.addExplosion=function(a,d){var k={};k.x=a;k.y=d;k.a=1;c.push(k)};this.addShot=function(g,d,c,f){if(50>+new Date-aa&&Y){var e=players[g];if(e){var b={};b.id=g;b.angle=e.angle;b.isKing=currentKingID==g;b.hitPosition={x:10*d,y:10*c};b.special=0;gameEvent.isInstagib()?b.special=1:gameEvent.isSpaceWars()&&(b.special=2);b.a=1;b.weapon=f;d=dc(0,
-10,e.angle);g=e.x+d.x;c=e.y+d.y;b.origPosition={x:g,y:c};e=b.hitPosition.x-g;d=b.hitPosition.y-c;f!=WEAPON_LASER&&(f=Math.sqrt(e*e+d*d),b.direction={x:e/f,y:d/f},b.curPosition={x:g,y:c},b.finish=!1,(Ma(g,c,100)||Ma(b.hitPosition.x,b.hitPosition.y,100))&&a.push(b));f=areaHeight/2;b.hitPosition.y>f&&(g=d/e,Qb.addSplash((f-(b.hitPosition.y-g*b.hitPosition.x))/g,f+6,1,!1))}}};this.addMissileImpact=function(a,d){var c=10*a,f=10*d;if(Ma(c,f,100)&&50>+new Date-aa){var e=U.createAnimation("explosion");e.setScale(1);
e.posX=10*a;e.posY=10*d;U.runAnimationBehind(e);c=1-Cb(c,f,ea.x,ea.y)/PLAY_DISTANCE;F.playSound(SOUND_MISSILE_EXPL,c,1,zc,null)}};this.addSplash=function(a,d,c,f){if(drawSplashes&&!gameEvent.isSpaceWars()&&Ma(a,d,100)&&50>+new Date-aa){var e=U.createAnimation("splash"),b=U.createAnimation("splashReflex");e.setScale(c);f&&(e.scaleX*=1.2+.4*Math.random());e.posX=a;e.posY=d-61*e.scaleY/2;U.runAnimation(e);b.scaleX=e.scaleX;b.posX=e.posX;b.posY=e.posY+77;b.scaleY=-2;U.runAnimationLayer2(b)}}},Vc=function(){var a,
c,g,d=0,k,f,e,b=[],v=!1,m,C,h,A,q,w,l,r,n=0,z=!0,K=300,na=!1,F=null,H=null,G=0,x=0,E=0,Fa=0,u,X,ja,ba,ka,ca=0;this.draw=function(m){var h=Date.now();if(0<d){var q=0,J=h-d;4E3>J?q=3E3>J?1:1-(J-3E3)/1E3:d=0;var A=!1;if(!f){var G=22;g?(e=new wa(36*s,"#00FFFF",!1,"#00AAAA"),e.setValue(g),e.setUsingRoundedFrame(!0),A=!0,e.setAddTop(35),e.setShadowBlur(4)):(e=null,G=35);f=new wa(G*s,"#00FFFF",!1,"#00AAAA");f.setValue(c);f.setUsingRoundedFrame(!A);f.setShadowBlur(3);g||f.setAddTop(-2)}J=.21*canvas.height;
1==k&&(J=.65*canvas.height,f.setColor("#f90600"),f.setStrokeColor("#f90600"),f.setRoundedFrameStyle("#f90600"),e&&(e.setColor("#f90600"),e.setStrokeColor("#f90600"),e.setRoundedFrameStyle("#FF9999"),e.setRoundedFrameOpacity(.1)));G=f.render();A&&e.setMinWidth(G.width);var t;g&&(t=e.render());m.globalAlpha=q;m.save();m.scale(s,s);t&&m.drawImage(t,.5*canvas.width/s-t.width/2,(J-5)/s);m.drawImage(G,.5*canvas.width/s-G.width/2,J/s);m.restore();m.globalAlpha=1}for(A=t=0;A<b.length;A++){G=b[A];q=G.text;
q||(q=new wa(G.size*s,"#00FFFF",!1,"#00AAAA"),q.setValue(G.message),q.setUsingRoundedFrame(!0),q.setShadowBlur(3),q.setColor("#00FFFF"),q.setStrokeColor("#00FFFF"),q.setRoundedFrameStyle("#00FFFF"),q.setRoundedFrameOpacity(.11),G.text=q);J=h-G.time;if(4E3<=J){b.splice(A,b.length);break}G=q.render();q=G.height+8;0>=J?(G=J+200,0<G&&(t-=G/200*q)):(t-=q,q=200>J?J/200:3E3<J?(4E3-J)/1E3:1,m.globalAlpha=q,J=.3*canvas.height,m.save(),m.scale(s,s),m.drawImage(G,.5*canvas.width/s-G.width/2,J/s+t),m.restore(),
m.globalAlpha=1)}if(L&&B){if(!u||E!=Wa||$a)u=new wa(25*s,"#00FFFF",!1,"#00AAAA"),u.setValue("ZAPS: "+Wa),ja=u.render(),E=Wa;if(!X||Fa!=x||$a)X=new wa(25*s,"#00FFFF",!1,"#00AAAA"),X.setValue("SCORE: "+x),ba=X.render(),Fa=x;if(!ka||$a)ka=new wa(25*s,"#00FFFF",!1,"#00AAAA"),ka.setValue("TALK"),ka.render();$a=!1;m.save();m.scale(s,s);m.globalAlpha=.3;m.drawImage(ja,5,canvas.height/s-ja.height-ba.height-5);m.drawImage(ba,5,canvas.height/s-ja.height-5);m.globalAlpha=1;m.restore()}v&&(C=y.createElement("canvas"),
h=C.getContext("2d"),this.renderLeaderboard(h,C),v=!1);C&&L&&this.drawLeaderboard(m);w&&(0<n&&z||!z||0<K)&&(null==r&&(h=parseInt(20*s)+1,l=new wa(h,F,!1,F),l.setValue(w),l.setUsingRoundedFrame(!0),l.setRoundedFrameStyle(H),l.setShadowBlur(2),r=l.render()),m.drawImage(r,ma/2-r.width/2,1.1*r.height*(na?1-K/300:K/300)-r.height));a!=s&&(a=s)};this.drawTalkWaitFx=function(b,a,e,d,v){var f=-Math.PI/2;v=2*Math.PI*v+f;b.beginPath();b.lineWidth=2*d;b.arc(a,e,d,0,2*Math.PI,!1);b.strokeStyle="#00FFFF";b.globalAlpha=
.1;b.stroke();b.beginPath();b.arc(a,e,d,f,v,!1);b.globalAlpha=.6;b.stroke()};this.update=function(b){0<K?(K-=b,0>=K&&!na&&(w=null)):K=0;z&&(n-=b);z&&0>=K&&na&&0>=n&&(na=!1,K=300);0<ca&&(ca-=b/500,0>ca&&(ca=0))};this.renderLeaderboard=function(b,a){function e(a){q+=c+v;a=b.measureText(Ua(a)).width;E<a&&(E=a)}h=280;q=0;var d=5*s,v=10*s,f=23*s,c=18*s,g,C=0*s,k=5*s,u="",w="'proxima-nova-1','proxima-nova-2', Arial Black";0==Va&&(u="Bold ",w="Arial");q+=d+f+d+12;g=6+d+f+d;for(var E=0,l=!1,r=0;5>r;r++){var da=
m[r];da&&(V!=da.id||l||(l=!0),e(da.nick.substring(0,16)))}!l&&B&&e(B.nick);E>C&&(h+=E-C);A=h*s;a.width=A;a.height=q;b.fillStyle="#003a3a";b.globalAlpha=.3;Eb(b,6,6,A-12,q-12,15*s);b.globalAlpha=1;b.shadowColor="#337777";b.shadowBlur=6;b.fillStyle="#337777";b.globalAlpha=.5;Nc(b,6,6,A-12,32*s,15*s);b.globalAlpha=1;b.font=u+f+"px "+w;b.textBaseline="middle";C=b.measureText("LEADERBOARD").width;b.fillStyle="#09ffff";b.shadowColor="#09ffff";b.shadowBlur=6;b.fillText("LEADERBOARD",A/2-C/2,d+6+f/2);b.shadowBlur=
2;f=u+c+"px "+w;b.font=f;g+=k;for(r=0;5>r;r++)if(da=m[r]){var k=0==r&&0<ra,Cc,u=r+1+". ";k&&(Cc=b.measureText(u).width,u+="      ");var u=u+Ua(da.nick),bb=0;b.fillStyle=V==da.id?"#09ffff":"rgba(0,255,255,0.4)";b.font=f;C=b.measureText(u).width;b.fillText(u,6+d,g+bb+c/2);C=O(da.score);da=b.measureText(C).width;b.fillText(C,A-d-da-6,g+bb+c/2);k&&(b.save(),b.translate(6+d+Cc+10,g+bb+c/2-1),da=1,sa||(da=.5),b.scale(.8*da,.8*da),db()?t.frames.santa_hat.draw(b):t.frames.crown.draw(b),b.restore());g+=c+
v}!l&&B&&(b.fillStyle="#09ffff",u=G+". "+Ua(B.nick),C=b.measureText(u).width,b.fillText(u,6+d,g+bb+c/2),l=O(x),da=b.measureText(l).width,b.fillText(l,A-d-da-6,g+bb+c/2))};this.drawLeaderboard=function(b){b.drawImage(C,ma-A-5,5)};this.addMessage=function(b,a,e){c=b;f=null;g=e;d=Date.now();k=a};this.addSpecialMessage=function(a,e){var d=Date.now();0<b.length&&(d=200+Math.max(d,b[0].time+200));b.unshift({message:a,text:null,time:d,size:e})};this.refreshLeaderboard=function(b){m=b;v=!0};this.showTip=
function(b,a,e,d){w&&this.clearTip();w=b;n=a;z=0<a;r=null;K=300;na=!0;e?(F=e,H=d):(F="#00FFFF",H="#006666")};this.clearTip=function(){na=!1;K=300};this.updateRank=function(b,a){G=b;x=a};this.cantTalk=function(){ca=1};this.toggleTalkLayer=function(){};this.hideTalkLayer=function(){};this.fastHideTalkLayer=function(){}},Ub=function(){var a=this;this.snake=!0;this.killReason=0;this.id=-1;this.lastServerY=this.lastServerX=this.dstY=this.dstX=this.origY=this.origX=this.prevY=this.prevX=this.y=this.x=0;
this.points=[];this.renderedPoints=[];this.pointServerFix=[];this.curLengthDst=this.curLength=0;this.netDirection=this.direction=1;this.hue=0;this.attached=!0;this.inside=this.still=this.decay=this.shock=this.invulnerable=this.attracting=!1;this.nick="";this.lastUpdateTime;this.highlightSin=this.highlightTime=0;this.beingDeleted=this.redTone=!1;this.snakeScale=1;this.killedByID=0;var c=1;this.locatorValue=0;ob++;var g=!1,d=0,k=0,f=0,e=0,b=0,v=0,m=0,C=!1,h,A={},q={},w,n,s=99,y=!1,Ac,K,na,Bc,H,G,x=
0,E=[],Fa=[],u=0,X=0,ja=1,ba=0;this.lastSpeed=0;this.waitingPoints=[];var ka=0,ca=0;this.headPos=void 0;this.shiftLen=0;var M=[];this.tutorial=!1;var R=0,O,I,Ga,ab=.4,oa=0;this.playSounds=!0;var U=!1,P=!1,va=0,Ha=0,Ia=0,ua=!1,pa=0;this.talkStamina=0;var W=1;this.processPoint=function(b){this.setTurnPoint(b.d,b.x,b.y);ka--;this.waitingPoints.splice(0,1);var a=ha(this.x,this.y,b.x,b.y),e=fb(b.d);this.x=b.x+e.x*a;this.y=b.y+e.y*a;0<ka&&(e=this.waitingPoints[0],b=ha(e.x,e.y,b.x,b.y),a>b&&this.processPoint(e))};
this.update=function(a){if(this.beingDeleted)if(y)this.snakeScale-=.1,0>this.snakeScale&&(this.id==V&&(qa.direction=1,V=0,B=null),delete z[this.id],this.cleanup());else{var c=ha(this.x+q.x,this.y+q.y,A.x,A.y);c>s?(y=!0,this.points.unshift({x:this.x,y:this.y}),this.x=A.x,this.y=A.y):(this.x+=q.x,this.y+=q.y);s=c;R+=a;3E3<R&&!y&&(N&&console.log("bf"),y=!0)}else{n=w;w=Db((aa-this.lastUpdateTime)/Da,0,1);if(n==w)return;this.prevX=this.x;this.prevY=this.y;var h=c=0,c=w*(this.dstX-this.origX)+this.origX,
h=w*(this.dstY-this.origY)+this.origY;Math.atan((this.dstY-this.origY)/(this.dstX-this.origX));this.x=c;this.y=h;c=this.x-this.prevX;h=this.y-this.prevY;if(0<ka){var u=this.waitingPoints[0];ha(this.x,this.y,u.x,u.y);var J=!1;if(1==this.direction||3==this.direction){if(this.prevY<=u.y&&this.y>=u.y||this.y<=u.y&&this.prevY>=u.y)J=!0}else if(this.prevX<=u.x&&this.x>=u.x||this.x<=u.x&&this.prevX>=u.x)J=!0;J&&this.processPoint(u)}c=Math.abs(c);h=Math.abs(h);K=Ac;Ac=c>h?c:h;c=w*(b-f)+f;h=w*(v-e)+e;d=c;
k=h}this.curLength+=(this.curLengthDst-this.curLength)/10;H&&this.headPos&&H.setPosition(this.headPos.x,this.headPos.y);H&&H.update(a);30<m||C?H.enabled||H.setEnabled(!0):30>=m&&H.enabled&&H.setEnabled(!1);this.playSounds&&(oa=cc(this.x,this.y));Y?T&&(oa*=.3):oa=0;O&&this.playSounds&&(ab-=.01,0>ab&&(ab=0),F.sound._nodeById(O).bufferSource.playbackRate.value=.8+m/100*1.5-ab,F.sound.volume((Dc+m/100*(Wc-Dc))*oa*S,O));I&&this.playSounds&&(c=Math.max(0,(m-30)/70),F.sound.volume(c*Xc*oa*S,I));Ga&&this.playSounds&&
(F.sound._nodeById(Ga),U?F.sound.volume(Yc*oa*S,Ga):F.sound.volume(0,Ga));g&&!ta&&L&&B==this&&(Ia+=a,2E3<Ia&&(ta=1,l.localStorage.speedUpTut=1));pa-=a/1E3*20;0>pa&&(pa=0)};this.drawCircle=function(b,a,e,d,v){b.beginPath();b.arc(a,e,v,0,2*Math.PI,!1);b.fillStyle=d;b.fill()};this.drawSpark=function(b,a,e,d,v,f){E[v]&&(f.save(),f.globalAlpha=c,f.translate(b,a),f.rotate(e),f.scale(d,d),f.translate(0,-(E[v].height/2)),E[v].draw(f),f.restore())};this.drawTail=function(b,a){var e=b.length,d=b[0].x,f=b[0].y;
a.beginPath();a.moveTo(d,f);for(d=1;d<e;d++)a.lineTo(b[d].x,b[d].y);a.stroke()};this.getWidth=function(){var b=this.curLength-Ib,b=b/1E3+2.5;8<b&&(b=8);return b*(5-4*this.snakeScale)};this.getPointList=function(b){for(var a=this.points.length,e=this.x,d=this.y,f=0,v=b.length,c=b[0],g=[],m=0;m<a;m++){p=this.points[m];var C=ha(e,d,p.x,p.y),f=f+C;if(f>c){var k=f-c,c=e-p.x,h=d-p.y,k=Math.sqrt(c*c+h*h)-k,c=gb(c,h);c.x*=k;c.y*=k;g.push({x:e-c.x,y:d-c.y});f-=C;m--;v--;b.splice(0,1);c=b[0];if(0==v)break;
else continue}e=p.x;d=p.y}return g};this.calcRenderPoints=function(){var b=[],a=this.points.length,e=0,d=this.x,f=this.y,c=0,v={x:this.x,y:this.y};V==this.id||this.tutorial||(c=Math.max(qb/2+ca/2-yb+sc,0)*this.lastSpeed/Da);for(var g=!1,m,C=0;C<a;C++){m=this.points[C];var k=ha(d,f,m.x,m.y),e=e+k;if(g)if(e>this.curLength){g=e-this.curLength;e=d-m.x;m=f-m.y;k=Math.sqrt(e*e+m*m);g=k-g;m=gb(e,m);m.x*=g;m.y*=g;b.push({x:d-m.x,y:f-m.y});break}else b.push({x:m.x,y:m.y});else if(e>c){g=e-c;e=d-m.x;m=f-m.y;
k=Math.sqrt(e*e+m*m);g=k-g;m=gb(e,m);m.x*=g;m.y*=g;d-=m.x;f-=m.y;b.push({x:d,y:f});v.x=d;v.y=f;e=0;g=!0;C--;continue}d=m.x;f=m.y}0==b.length&&b.push({x:0,y:0});this.headPos=v;this.renderedPoints=b;this.shiftLen=c};this.drawAfter=function(b){var a=50;this.beingDeleted&&(a=100);ua&&(a=100);var a="hsl("+this.hue+", 100%, "+a+"%)",e=this.getWidth();ja=e/2.5;1<ja&&(ja=1+.6*(ja-1));this.calcRenderPoints();U=!1;var f=(100-m)/30;if(g&&this.headPos){if(0<u){var v=z[u];if(v){var C=v.getWidth()/2+.1,q=this.headPos.x-
d,w=this.headPos.y-k,A=Math.atan2(w,q),E=A+Math.PI/2,G=Math.sin(-E),r=Math.cos(-E),G=G*C,r=r*C,l=d-G,C=k-r,q=this.headPos.x-l,w=this.headPos.y-C,l=(this.headPos.x+l)/2,cb=(this.headPos.y+C)/2,C=parseInt,Ec;Ec=3*Math.random()+0;C=C(Ec);q=Math.sqrt(q*q+w*w);0==x&&5<=q&&(b.save(),b.globalAlpha=c,b.translate(l,cb),b.rotate(A+Math.PI/2),A=q/t.frames.lightning1.height,w=Math.random(),cb=l=1,.25>w?l=-1:.5>w?cb=-1:.75>w&&(cb=l=-1),b.scale(A*l,A*cb),Fa[C].draw(b),b.restore());A=!1;if(2>f||20>=q)U=A=!0;w=Math.max(.2,
Math.min(.5,1-q/40))+0;40<m&&(w+=(m-40)/60*.3);A&&v.drawSpark(d-G,k-r,E,w,C,b);5>q&&v.drawSpark(d+G,k+r,E,-w,C,b)}}x++;2>f&&(f=2);x>f&&(x=0,this.playSounds&&F.playSound(Zc,$c*oa*S,1,$,null))}sa&&(b.shadowColor=a,b.shadowBlur=5);b.save();b.globalAlpha=1*c;b.beginPath();b.lineWidth=e*this.snakeScale;b.lineCap="round";b.lineJoin="round";b.strokeStyle=a;a=60;this.beingDeleted&&(a=100);ua&&(a=100,b.lineWidth=(e+1)*this.snakeScale);b.strokeStyle="hsl("+this.hue+", 100%, "+a+"%)";sa&&(b.shadowBlur=15);this.drawTail(this.renderedPoints,
b);ua&&(b.lineWidth=e*this.snakeScale,b.strokeStyle="hsl(0, 100%, 0%)",this.drawTail(this.renderedPoints,b));4E3<this.curLength&&sa&&(a=1,4500>this.curLength&&(a=1-(4500-this.curLength)/500),b.globalAlpha=a*c,b.shadowBlur=5,b.lineWidth=(e-2)*this.snakeScale,a="hsl("+this.hue+", 100%, 90%)",b.strokeStyle=a,b.shadowColor=a,a=e/4*1.5,b.setLineDash([10*a,12*a]),tt=15*ja,b.lineDashOffset=tt,this.drawTail(this.renderedPoints,b),b.globalAlpha=1);10<m&&(a=(m-10)/50,50<m&&(a=1),b.globalAlpha=a*c,b.shadowBlur=
0,b.strokeStyle="hsl("+this.hue+", 100%, 90%)",b.lineWidth=(e-.8)*this.snakeScale,this.drawTail(this.renderedPoints,b),b.globalAlpha=1*c);b.shadowBlur=0;b.translate(this.headPos.x,this.headPos.y);30<m&&(e=(m-30)/70,0==X&&(e*=.5),b.globalAlpha=.4*e*c,b.scale(.9,.9),Bc.draw(b),b.scale(1/.9,1/.9),b.globalAlpha=1*c);5<m&&(e=(m-5)/50,50<m&&(e=1),e*=.6,b.scale(e,e),na.draw(b),b.globalAlpha=1*c,b.scale(1/e,1/e),X++,2<X&&(X=0));e=this.snakeScale*ja;b.scale(.21*e,.21*e);h.draw(b);b.restore();b.shadowBlur=
0;b.globalAlpha=.7*c;a=this.getPointList([2.5*e+this.shiftLen,5*e+this.shiftLen,7.5*e+this.shiftLen,8.5*e+this.shiftLen]);4==a.length&&(b.save(),f=a[0],b.translate(f.x,f.y),b.scale(.19*e,.19*e),h.draw(b),b.restore(),b.globalAlpha=.5*c,b.save(),f=a[1],b.translate(f.x,f.y),b.scale(.16*e,.16*e),h.draw(b),b.restore(),b.globalAlpha=.3*c,b.save(),f=a[2],b.translate(f.x,f.y),b.scale(.12*e,.12*e),h.draw(b),b.restore(),b.globalAlpha=.1*c,b.save(),f=a[3],b.translate(f.x,f.y),b.scale(.12*e,.12*e),h.draw(b),
b.restore());b.globalAlpha=1*c;H&&(H.alpha=1*c,H.draw(b));b.globalAlpha=1};this.draw=function(b){};this.drawInput=function(b){};this.drawKillStreakIcon=function(b,e){var a=0;8<=e&&13>e?a=0:13<=e&&18>e?a=1:18<=e&&23>e?a=2:23<=e&&(a=3);var d;d=(e-8)/22*.8;.8<d&&(d=.8);d=1+d;b.scale(d,d);b.translate(0,-4*d);t.frames.skullback.draw(b);0==a?(t.frames.skullbase.draw(b),t.frames.skullglow.draw(b),8<e&&t.frames.skulleyesred.draw(b)):1==a?(t.skullDarkBlue.draw(b),t.skullDarkBlueGlow.draw(b),t.frames.skulleyesyellow.draw(b)):
2==a?(t.skullPurple.draw(b),t.skullPurpleGlow.draw(b),t.frames.skulleyesgreen.draw(b)):3==a&&(t.skullRed.draw(b),t.skullRedGlow.draw(b),t.frames.skulleyesblue.draw(b));t.frames.skullgradient.draw(b);b.fillStyle="rgba(0, 200, 255, 1.0)";b.font="Bold 18px 'proxima-nova-1','proxima-nova-2', Arial";b.shadowBlur=5;b.shadowColor="rgba(0, 200, 255, 1.0)";a=b.measureText(e).width;b.fillText(e,-a/2,-30);b.shadowBlur=0;b.scale(1/d,1/d)};this.drawInfo=function(b){if(void 0!=this.headPos&&!this.beingDeleted){b.save();
b.globalAlpha=c;b.translate(this.headPos.x,this.headPos.y);var e=20,d=.5*(ja-1)+1,f=.55*d;this.id==ra&&(b.translate(0,-e*d),b.scale(f,f),db()?(2==this.netDirection&&(W=1),4==this.netDirection&&(W=-1),b.scale(W,1),t.frames.santa_hat.draw(b),b.scale(W,1)):t.frames.crown.draw(b),b.scale(1/f,1/f),b.translate(0,e*d),e+=20);P&&(f=.45*d,b.translate(0,-e*d),b.scale(f,f),t.frames.trophy.draw(b),b.scale(1/f,1/f),b.translate(0,e*d));b.globalAlpha=.85*c;b.fillStyle="rgba(255, 255, 255, 0.6)";b.font="Bold 10px 'proxima-nova-1','proxima-nova-2', Arial";
b.textBaseline="hanging";e=a.nick;d=b.measureText(e).width;b.fillText(e,-d/2,30);b.restore();0<pa&&(b.save(),b.globalAlpha=1,b.translate(this.headPos.x,this.headPos.y),e=Math.sin(pa),d=Math.sin(.75*Math.PI),e>d&&(e=d+.5*(1-d)),b.scale(e,e),b.fillStyle="rgba(0, 60, 60, 1.0)",b.font="Bold 8px 'proxima-nova-1','proxima-nova-2', Arial",b.textBaseline="hanging",e=b.measureText("").width,d=e/2+13,f=e+8,b.beginPath(),b.moveTo(-4,-4),b.lineTo(-27,-20),b.lineTo(-13,-20),b.closePath(),b.fill(),Eb(b,-f/2-d,
-24.5,f,13,6),b.fillStyle="rgba(0, 255, 255, 1.0)",b.fillText("",-e/2-d,-20),b.restore())}};this.updateNetwork=function(a,c,q){var w,A;w=10*a.getFloat32(c,!0);c+=4;A=10*-a.getFloat32(c,!0);c+=4;this.lastServerX=w;this.lastServerY=A;var x=a.getFloat32(c,!0);c+=4;var l=30*x;B==this&&(l>this.lastSpeed?(r.signalBoostState(!0),.693<x&&r.signalMaxSpeedReached()):l<this.lastSpeed&&r.signalBoostState(!1));this.lastSpeed=l;this.curLengthDst=10*a.getFloat32(c,!0);c+=4;this.netDirection=a.getUint8(c,!0);c+=
1;curPointCount=a.getUint16(c,!0);c+=2;0==ka&&0>=ba?(this.origX=this.x,this.origY=this.y,this.dstX=w,this.dstY=A):(this.origX=this.x,this.origY=this.y,x=fb(this.direction),this.dstX+=x.x*this.lastSpeed,this.dstY+=x.y*this.lastSpeed);l=a.getUint8(c,!0);c+=1;if(l&1){a.getFloat32(c,!0);c+=4;a.getFloat32(c,!0);c+=4;a.getFloat32(c,!0);c+=4;a.getFloat32(c,!0);c+=4;a.getFloat32(c,!0);c+=4;a.getFloat32(c,!0);c+=4;a.getFloat32(c,!0);c+=4;a.getFloat32(c,!0);c+=4;var n=a.getUint16(c,!0);c+=2;M=[];for(x=0;x<
n;x++){var s=a.getFloat32(c,!0);c+=4;var y=-a.getFloat32(c,!0);c+=4;M.push({x:10*s,y:10*y})}}l&2?(x=a.getFloat32(c,!0),c+=4,n=-a.getFloat32(c,!0),c+=4,u=a.getUint16(c,!0),c+=2,f=d,e=k,b=10*x,v=10*n,g||(d=b,k=v,f=b,e=v,g=!0),B==this&&(x=Math.abs(b-w)+Math.abs(v-A),r.signalRubbingOnEnemyState(u,x))):(g&&B==this&&r.signalRubbingOnEnemyState(null,null),g=!1);C=l&4?!0:!1;l&8&&(ca=a.getUint16(c,!0),c+=2);(x=l&16)&&!P&&B==this&&r.signalKingKilledByPlayer();P=x;l&32?(va=a.getUint16(c,!0),c+=2,Ha!=va&&B==
this&&L&&(Ha=va)):va=0;l&64&&(c+=1);this.talkStamina=a.getUint8(c,!0);c+=1;m=a.getUint8(c,!0)/255*100;c+=1;B==this&&(x=Math.max(0,Math.min(1,(this.curLengthDst-Ib)/mc)),Ob=nb-(nb-lc)*x);if(q){"demogorgon"==this.nick&&(ua=!0);this.origX=this.dstX;this.origY=this.dstY;this.x=this.dstX;this.y=this.dstY;this.curLength=this.curLengthDst;this.points=[];for(x=0;x<curPointCount;x++)q=a.getFloat32(c,!0),c+=4,w=-a.getFloat32(c,!0),c+=4,this.points.push({x:10*q,y:10*w});this.hue=a.getUint16(c,!0);c+=2;a.getUint8(c);
c+=1;G="hsl("+this.hue+", 100%, 50%)";a="hsl("+this.hue+", 100%, 90%)";q="hsl("+this.hue+", 100%, 70%)";h=t.frames.head_dot.renderTintedFrame("#FFFFFF");na=t.frames.glow.renderTintedFrame(G);Bc=t.frames.glow_hard.renderTintedFrame(a);Fa.push(t.frames.lightning1.renderTintedFrame(G));Fa.push(t.frames.lightning2.renderTintedFrame(G));Fa.push(t.frames.lightning3.renderTintedFrame(G));E.push(t.frames.spark0.renderTintedFrame(q));E.push(t.frames.spark1.renderTintedFrame(q));E.push(t.frames.spark2.renderTintedFrame(q));
a=t.frames.particleDot.renderTintedFrame("hsl("+this.hue+", 100%, 80%)");H=new Fc;H.particleFrame=a;H.init(10,this.x,this.y);this.playSounds&&(F.playSound(ad,0,1,$,function(b){O=b}),F.playSound(bd,0,1,$,function(b){I=b}),F.playSound(cd,0,1,$,function(b){Ga=b}))}else if(q=a.getUint8(c,!0),c++,0<q){w=[];for(x=0;x<q;x++)A=a.getFloat32(c,!0),c+=4,l=-a.getFloat32(c,!0),c+=4,w.push({x:10*A,y:10*l});if(this.id==V&&Sb){a=Math.min(ba,q);0>a&&(a=0);A=q-ba;for(x=0;x<a;x++)void 0!=w[x+A]&&(this.points[x]=w[x+
A]);for(x=0;x<q-a;x++)this.pointServerFix.unshift(w[x]);ba-=q}else{for(x=q-1;0<=x;x--)this.points.unshift(w[x]);this.playSounds&&F.playSound(Gc,Hc*oa*S,1,$,null)}}a=ba;0>a&&(a=0);a=curPointCount+a;a<this.points.length&&this.points.splice(a+1,this.points.length-a-1);this.lastUpdateTime=aa;return c};this.fixPoints=function(b,a,e){var c=ha(a,e,this.dstX,this.dstY),d=ha(this.origX,this.origY,a,e);b=fb(b);var f=b.y*c;this.dstX=a+b.x*c;this.dstY=e+f;c=b.y*d;this.origX=a-b.x*d;this.origY=e-c};this.setTurnPoint=
function(b,a,e){ba++;0<this.pointServerFix.length&&(a=this.pointServerFix[0].x,e=this.pointServerFix[0].y,this.pointServerFix.splice(0,1));this.points.unshift({x:a,y:e});this.direction=this.pendingDirection=b;this.fixPoints(b,a,e);this.playSounds&&F.playSound(Gc,Hc*oa*S,1,$,null)};this.findLastWaitingPoint=function(b){for(var a=this.x,e=this.y,c=0,d=0;d<ka;d++)b=this.waitingPoints[d],c+=ha(a,e,b.x,b.y),a=b.x,e=b.y,b=b.d;return{x:a,y:e,dist:c,direction:b}};this.addTurnPoint=function(b,a){300<qb&&(a+=
qb-300);var e=a*this.lastSpeed/Da,c=this.findLastWaitingPoint(this.direction),d=e-c.dist,f=fb(c.direction),e=c.x+f.x*d,c=c.y+f.y*d;ka++;this.waitingPoints.push({x:e,y:c,d:b});return{x:e/10,y:c/10}};this.deleteNetwork=function(b,a){this.id==V&&0<=Q+1&&(xb=this.killedByID,Aa=30);if(la&&0!=this.killReason){this.beingDeleted=!0;this.id==V&&D.shake(7+.13*m);var e=b.getFloat32(a,!0);a+=4;var c=-b.getFloat32(a,!0);a+=4;3==this.killReason?y=!0:(A.x=10*e,A.y=10*c,q.x=this.x-this.prevX,q.y=this.y-this.prevY,
q=gb(q.x,q.y),q.x*=K,q.y*=K);this.playSounds&&this.id!=V&&this.killedByID!=V&&F.playSound(dd,ed*oa*S,1.1,$,null)}else this.id==V&&(qa.direction=1,V=0,B=null),a=a+4+4,delete z[this.id],this.cleanup();return a};this.resume=function(){};this.cleanup=function(){ob--;O&&this.playSounds&&(F.sound.stop(O),F.sound.stop(I),F.sound.stop(Ga),I=O=null)};this.setKilledBy=function(b){this.killedByID=b};this.setDead=function(){y=!0};this.setRubSnakeID=function(b){u=b};this.setAlpha=function(b){c=b};this.onBlur=
function(){this.playSounds&&(F.sound.volume(0,O),F.sound.volume(0,I),F.sound.volume(0,Ga))};this.getTestValue=function(){return 7};this.getTalkTextByTalkID=function(b){return Qc[b-1]};this.canTalk=function(){return 255==this.talkStamina}},Ic=function(){this.id=-1;this.dstY=this.dstX=this.origY=this.origX=this.prevY=this.prevX=this.y=this.x=0;this.energy=255;this.nick="";this.hue=0;this.lastUpdateTime;var a=this.killedByID=0,c,g,d=0;this.canInterpolate=this.beingDeleted=!1;var k=this.beginGraby=this.beginGrabX=
this.killedByID=this.blendIn=0,f=Math.random()*Math.PI,e=.5<Math.random()?1:-1,b=0,v=1;this.playSounds=!0;this.tutorial=!1;this.update=function(a){a*=.06;if(this.beingDeleted){var e=z[this.killedByID];if(e){var c=Math.pow(d,2),f;f=e.x;e=e.y;this.x=this.beginGrabX+(f-this.beginGrabX)*c;this.y=this.beginGrabY+(e-this.beginGrabY)*c}d+=.07*a;1<d&&delete z[this.id]}else 1>b&&(b+=.03*a,1<b&&(b=1)),a=Db((aa-this.lastUpdateTime)/Da,0,1),this.prevX=this.x,this.prevY=this.y,c=a*(this.dstY-this.origY)+this.origY,
this.x=a*(this.dstX-this.origX)+this.origX,this.y=c;this.beingDeleted&&(k+=.2)};this.drawAfter=function(b){};this.draw=function(c){c.save();c.translate(this.x,this.y);a+=.05;var C=.2-.02*Math.sin(a),h=.2-.02*Math.sin(a),A=.75*Math.PI,A=Math.sin(Math.sqrt(b)*A)/.75;c.scale(C*A,h*A);c.rotate((Math.PI/4+a/15+f+2*b)*e);this.beingDeleted&&(c.rotate(k),0<this.killedByID?c.scale(1.7,1.7):c.scale(1-d,1-d));c.globalAlpha=v;g.draw(c);c.globalAlpha=1;c.restore()};this.drawInput=function(b){};this.drawInfo=function(b){};
this.updateNetwork=function(b,a,e){var d,f;d=b.getFloat32(a,!0);a+=4;f=-b.getFloat32(a,!0);a+=4;this.origX=this.x;this.origY=this.y;this.dstX=10*d;this.dstY=10*f;e?(this.origX=this.dstX,this.origY=this.dstY,this.x=this.dstX,this.y=this.dstY,this.hue=b.getUint16(a,!0),a+=2,c="hsl("+this.hue+", 100%, 50%)",g=t.frames.food.renderTintedFrame(c)):this.canInterpolate=!0;this.lastUpdateTime=aa;return a};this.deleteNetwork=function(b,a){this.killedByID==V&&0!=V&&r.signalFoodEaten();la?(this.beingDeleted=
!0,this.beginGrabX=this.x,this.beginGrabY=this.y,0<this.killedByID&&this.playSounds&&(lastDistVolume=cc(this.x,this.y),F.playSound(fd,gd*lastDistVolume*S,1.5,$,null))):delete z[this.id];return a};this.resume=function(){};this.cleanup=function(){};this.setKilledBy=function(b){this.killedByID=b};this.setAlpha=function(b){v=b}},hd=function(){var a=!1,c,g,d=null;this.preRenderSideLine=function(a){var e=y.createElement("canvas"),b=e.getContext("2d");a?(e.width=18,e.height=2*d+18):(e.width=2*d+18,e.height=
18);b.strokeStyle="#0555FF";b.beginPath();b.lineCap="round";b.moveTo(9,9);a?b.lineTo(9,9+2*d):b.lineTo(9+2*d,9);b.shadowColor="#0555FF";b.shadowBlur=9;b.strokeStyle="#AAFFFF";b.lineWidth=4.5;b.stroke();return e};this.preRenderSideLines=function(){c=this.preRenderSideLine(!0);g=this.preRenderSideLine(!1);a=!0};this.drawLimits=function(f){var e=D.getBounds(),b=ia/2;if(null==d)d=b;else{var b=(b-d)/20,v=Math.abs(b);1>v&&.001<v&&(v=1);.001<v&&(d+=b,this.preRenderSideLines())}a||this.preRenderSideLines();
f.save();f.translate(xa,ya);d+xa<=e[1].x&&(f.fillStyle="#023139",f.fillRect(d,-d-1E3,1E3,2E3+2*d));-d+xa>=e[0].x&&(f.fillStyle="#023139",f.fillRect(-d-1E3,-d-1E3,1E3,2E3+2*d));-fa/2+ya>e[0].y&&(f.fillStyle="#023139",f.fillRect(-d-2,-d-1E3,2*d+4,1E3));fa/2+ya<e[1].y&&(f.fillStyle="#023139",f.fillRect(-d-2,d,2*d+4,1E3));d+xa<=e[1].x&&f.drawImage(c,d-9,-d-9);-d+xa>=e[0].x&&f.drawImage(c,-d-9,-d-9);-fa/2+ya>e[0].y&&f.drawImage(g,-d-9,-d-9);fa/2+ya<e[1].y&&f.drawImage(g,-d-9,d-9);f.restore()};this.draw=
function(a){var e=D.getBounds(),b=1/D.zoom;a.save();a.globalCompositeOperation="source-over";a.fillStyle=t.bgGrid;a.scale(.65,.65);a.fillRect(e[0].x/.65,e[0].y/.65,canvas.width*b/.65,canvas.height*b/.65);a.restore()};var k=!1;this.update=function(a){if(Y||!k)k=!0}},jd=function(){var a,c=0;this.radiusFromMinimapRadiusPerc=function(a){return a=8E3/ia*(3+8*a)};this.radiusToMinimapRadius=function(a){return this.radiusFromMinimapRadiusPerc((a-1)/540)};this.draw=function(g){var d=ma-120*s-20*s,k=Z-120*
s-20*s;g.save();var f=s!=c;c=s;a&&!f||this.preRenderColliders();g.drawImage(a,d-20*s,k-20*s);if(B){for(var e=B.renderedPoints,f=[],b=e.length,v=0;v<b;v++){var m=e[v].x+ia/2-xa,C=e[v].y+fa/2-ya,m=m/ia,C=C/fa;f.push({x:m,y:C})}g.strokeStyle="hsl("+B.hue+", 100%, 50%)";g.lineWidth=2;e=f.length;m=f[0].x;C=f[0].y;g.beginPath();g.moveTo(d+120*m*s,k+120*C*s);for(v=1;v<e;v++)m=f[v].x,C=f[v].y,g.lineTo(d+120*m*s,k+120*C*s);g.stroke();0<ra&&(m=Ya+ia/2-xa,C=Za+fa/2-ya,m/=ia,C/=fa,g.translate(d+120*m*s,k+120*
C*s),g.scale(.5,.5),db()?t.frames.santa_hat.draw(g):t.frames.crown.draw(g))}g.restore()};this.update=function(a){};this.updateBoundaries=function(){};this.preRenderColliders=function(){a=y.createElement("canvas");var c=a.getContext("2d");a.width=160*s;a.height=160*s;c.lineWidth=4;c.strokeStyle="#00ffff";c.fillStyle="#002222";c.shadowBlur=10;c.shadowColor="#00ffff";c.beginPath();c.rect(20*s,20*s,120*s,120*s);c.stroke();c.globalAlpha=.5;c.shadowBlur=0;c.fill();c.globalAlpha=1}},kd=function(){function a(a){for(var b=
1;;){var c=a.getUint8(b,!0),b=b+1;if(0==c)break;switch(c){case 1:var c=a.getUint16(b,!0),b=b+2,b=hb(a,b),d=b.nick,b=b.offset;r.signalEnemyKilledByPlayer(c,d);Wa++;D.shake(7);break;case 2:a.getUint16(b,!0);b+=2;b=hb(a,b);d=b.nick;b=b.offset;R.addMessage("Zapped by ",1,Ua(d));ic=Ua(d);break;default:console.log("Unknown event code")}}}function c(a){for(var b=1,c=[],d=!1;;){var f=a.getUint16(b,!0),b=b+2;if(0==f)break;var d=!0,g;g=a.getUint32(b,!0);var b=b+4,b=hb(a,b),k=b.nick,b=b.offset,q={};q.nick=k;
q.score=g;q.id=f;c.push(q)}d&&R.refreshLeaderboard(c);return b}function g(a){for(var b=1;;){var c=a.getUint16(b,!0),b=b+2;if(0==c){b!=a.byteLength&&(ra=a.getUint16(b,!0),b+=2,0<ra&&(c=a.getFloat32(b,!0),b+=4,a=-a.getFloat32(b,!0),tb=Ya,ub=Za,vb=10*c,wb=10*a,qc=aa));break}var d=a.getUint8(b,!0),b=b+1,f;switch(d){case 0:(f=z[c])?b=f.updateNetwork(a,b,!1):console.log("entity with id: "+c+" not found");break;case 1:var d=a.getUint8(b,!0),b=b+1,g=a.getUint8(b,!0),b=b+1,b=hb(a,b),k=b.nick;-1!=k.indexOf("\ufdfd")&&
(k="<Unnamed>");b=b.offset;f=d;var q=null;switch(f){case 5:q=new Ub;break;case 4:if(0==g)q=new Ic;else if(1==g)q=new Energy;else if(2==g||3==g)q=new Tri(g);break;case 1:q=g==SUB_ENTITY_BOUNDARY?new Boundary:new Collider(g);break;default:console.log("ERROR: Creating unknown entity type: "+f+" Subtype: "+g),assert(!1,"Invalid Entity")}(f=q)?(f.nick=k,f.id=c,z[c]=f,b=f.updateNetwork(a,b,!0)):console.log("Unable to create entity. Entity Type is: "+d);break;case 2:d=a.getUint16(b,!0);b+=2;k=a.getUint8(b);
b+=1;(f=z[c])?(f.killReason=k,f.killedByID=d,c=f==B,b=f.deleteNetwork(a,b),c&&L&&(r.signalWasKilled(f),L=!1,B=null,qa.angle=Math.PI,qa.throttle=0,Q++,Wa=0,l.localStorage.killCount=Q,R.fastHideTalkLayer(),Ta()&&parent&&(d=r.lastGameStats(),c=Math.min(99,Math.ceil(d.gameFoodEaten/10)),d=Math.min(13,Math.ceil(d.gameTime/3E4)),k=Math.min(41,Q-Pc),c=(10>c?"0":"")+c,c+=(100>d?"0":"")+d,c+=(100>k?"0":"")+k,l.parent.postMessage(JSON.stringify({eventType:"dataEvent",key:"data",value:c}),"*")),Xa||$b())):(console.log("ERROR: Entity does not exist: "+
c),l.location.href=l.location.href);break;default:console.log("Invalid entity flag")}}}var d,k;this.sentHello=this.hasConnection=!1;this.remoteHost=null;this.connectRetry=0;this.lastUpdateBool=!1;this.roomNumber=0;this.directed=!1;this.roomID=0;this.connectVar=null;var f=Na,f=1==hc||3==hc?Na+":81/":"master."+Na,f="powerline-master.coolmathgames.com";this.getServerAndConnect=function(){var a="";if(lb)a=";"+lb,n.directed=!0;else if(queryString.ip){a=queryString.ip;a=a.replace("%3A",":");n.remoteHost=
a;n.connect();return}var b=Ra;queryString.cc&&(b=queryString.cc);if(void 0==b)setTimeout(n.getServerAndConnect,200);else{var c="";Hb&&(c="s");h.ajax({url:"http"+c+"://"+f,type:"PUT",success:function(b){if("0"==b)h("#topGui").hide(),h("#topGuiConnecting").hide(),h("#roomFailed").show();else{var a=b.split("!");n.roomID=0;1<a.length&&(n.roomID=a[1]);var c=a[0],a=c.split("index.html");n.roomNumber=0;1<a.length&&(n.roomNumber=a[1],c=a[0]);N&&(console.log("Res from master: "+b),console.log("Room number: "+n.roomNumber));
n.remoteHost=c;n.connect()}},error:function(){n.connectVar=setTimeout(n.getServerAndConnect,1E3)},dataType:"text",contentType:"text/plain",method:"PUT",cache:!1,crossDomain:!0,data:b+a})}};this.connect=function(){if(la||N){var a="ws://"+n.remoteHost,a=a.split(":");if(Hb){var b;b=9080;0<n.roomNumber&&(b+=parseInt(n.roomNumber));a="wss:"+a[1]+":"+b;N&&console.log("ssl fullhost: "+a)}else a="ws:"+a[1]+":"+(parseInt(n.roomNumber)+8080);N&&console.log("Connecting to "+a+"...");try{d=new WebSocket(a)}catch(c){setTimeout(n.getServerAndConnect,
1E3);return}d.binaryType="arraybuffer";d.onopen=n.onSocketOpen;d.onclose=n.onSocketClose;d.onmessage=n.onSocketMessage;d.onerror=n.onError}else setTimeout(n.getServerAndConnect,100)};this.disconnect=function(){n.directed&&(Ta()||(l.location.hash=""),n.directed=!1);n.roomID=0;d&&d.close()};this.onSocketOpen=function(a){n.connectVar&&clearTimeout(n.connectVar);N&&console.log("Connected!");n.connectRetry=0;n.hasConnection=!0;n.directed=!1;t.loaded&&n.hello()};this.onSocketClose=function(a){n.connectionClosed()};
this.onSocketMessage=function(a){n.processMessage(a.data)};this.onError=function(a){console.log("socket error")};this.hello=function(){n.sendHello();n.ping();n.sentHello=!0;h("#copyLink").fadeIn(300);h("#topGui").show();h("#topGuiConnecting").hide();h(".btn-needs-server").removeAttr("disabled");h("#nick").focus()};this.processConfig=function(a,b){var c=1,d=!1;176==b&&(d=!0);var f=a.getFloat32(c,!0),c=c+4;ia=10*f;fa=10*f;d&&(xa=10*a.getFloat32(c,!0),c+=4,ya=10*a.getFloat32(c,!0),c+=4);N&&console.log(ia/
10);nb=a.getFloat32(c,!0);c+=4;lc=a.getFloat32(c,!0);c+=4;mc=10*a.getFloat32(c,!0);c+=4;Ib=10*a.getFloat32(c,!0);c=c+4+4;yb=a.getFloat32(c,!0);c+=4;a.getFloat32(c,!0);c+=4;Sb=0==yb?!1:!0;sc=a.getFloat32(c,!0);c+=4;a.getFloat32(c,!0);oc=!0};this.processMessage=function(e){e=new DataView(e);var b=e.getUint8(0);if(1==b)rb&&(e=+new Date-k,I&&I.updateLag(e),150<e?this.ping():setTimeout(function(){n.ping()},150-e));else if(0==b)b=1,qb=e.getUint16(b,!0),b+=2,n.pong();else if(160==b||176==b)this.processConfig(e,
b);else if(161==b){var b=1,d=e.getUint32(b,!0),b=b+4;V=d;L=!0;Bb();r.signalGameStart()}else 163==b?(g(e),objectCount=Object.keys(z).length,y.title=0<objectCount&&N?"powerline.io ("+ob+", "+objectCount+")":"powerline.io!"):164==b?a(e):165==b&&(b=c(e),d=e.getUint16(b,!0),b+=2,0<d?(d=e.getUint32(b,!0),b+=4,e=e.getUint16(b,!0),b+=2,R.updateRank(e,d),e!=tc&&(r.signalUpdateRank(e),tc=e),d!=uc&&(r.signalUpdateScore(d),uc=d)):R.updateRank(0,0))};this.connectionClosed=function(){r.signalWasKilled(null);W.gameCleanup();
n.sentHello=!1;n.hasConnection=!1;$b(-1);h("#topGui").hide();h("#topGuiConnecting").show();h("#copyLink").fadeOut(300);h(".btn-needs-server").attr("disabled","disabled");var a=this.connectRetry;5<a&&(a=5);la&&setTimeout(this.getServerAndConnect,1E3+1E3*a);n.connectRetry++};this.sendSingleByte=function(a){var b=new ArrayBuffer(1);(new DataView(b)).setUint8(0,a);d.send(b)};this.sendHello=function(){var a=new ArrayBuffer(5),b=new DataView(a);N?b.setUint8(0,171):b.setUint8(0,191);b.setUint16(1,ma/10*
1,!0);b.setUint16(3,Z/10*1,!0);d.send(a)};this.sendNick=function(a){myName=a;a=new ArrayBuffer(7);var b=new DataView(a);b.setUint8(0,3);b.setUint8(1,Pa);b.setUint8(2,Qa);d.send(a)};this.sendTurnPoint=function(a,b){var c=new ArrayBuffer(11),f=new DataView(c),g=0;f.setUint8(g,6);g+=1;f.setUint8(g,a,!0);g+=1;f.setFloat32(g,b,!0);var k=0;if(!la||T)k|=1;f.setUint8(g+4,k,!0);d.send(c)};this.sendDirection=function(){var a=new ArrayBuffer(3),b=new DataView(a);b.setUint8(0,5);b.setUint8(1,qa.direction,!0);
var c=0;if(!la||T)c|=1;b.setUint8(2,c,!0);d.send(a)};this.sendResize=function(){var a=new ArrayBuffer(5),b=new DataView(a);b.setUint8(0,7);var c=1;sa||(c=2);b.setUint16(1,ma/10*1*c,!0);b.setUint16(3,Z/10*1*c,!0);d.send(a)};this.sendBoost=function(a){var b=new ArrayBuffer(2),c=new DataView(b);c.setUint8(0,8);a?c.setUint8(1,1):c.setUint8(1,0);d.send(b)};this.leave=function(){var a=new ArrayBuffer(1);(new DataView(a)).setUint8(0,4);d.send(a)};this.bigPicture=function(){var a=new ArrayBuffer(1);(new DataView(a)).setUint8(0,
11);d.send(a)};this.debugFoodGrab=function(){var a=new ArrayBuffer(1);(new DataView(a)).setUint8(0,9);d.send(a)};this.sendTalk=function(a){var b=new ArrayBuffer(2),c=new DataView(b);c.setUint8(0,12);c.setUint8(1,a);d.send(b)};this.ping=function(){if(this.hasConnection){var a=new ArrayBuffer(1);(new DataView(a)).setUint8(0,0);d.send(a);k=+new Date}};this.pong=function(){if(this.hasConnection){var a=new ArrayBuffer(1);(new DataView(a)).setUint8(0,16);d.send(a)}}},rd=function(a){function c(){R=new Vc;
Qb=new Uc;n.hasConnection&&!n.sentHello&&n.hello();v.init()}var g=this,d=[{},{}],k,f;this.context=f;var e=0,b=0,v,m=1,C=!1;g.update=function(a){R&&R.update(a);laserExists=!1;for(var c in z){var d=z[c];d.tutorial||(d.update(a),c==V&&(B=z[c]))}justTurned=!1;D.update(a);U.update(a);ea={x:(k.width/2+(D.x*D.zoom-k.width/2))/D.zoom,y:(k.height/2+(D.y*D.zoom-k.height/2))/D.zoom};0<xb&&1<Aa&&(Aa-=.2,1>Aa&&(Aa=1));sb.update(a);Rb.update(a);0<ra&&this.updateOffscreenInfo(1);Ba||T?1==Ba&&0<e&&(e-=a/1E3*3,0>=
e&&(e=0)):(e+=a/1E3*3,1<e&&(e=1));1==Ba&&(ta&&!(0<Oa)||T?1==ta&&0<b&&(b-=a/1E3*3,0>=b&&(b=0)):(Oa-=a,0>Oa&&(Oa=0),b+=a/1E3*3,1<b&&(b=1)));v.isInitialized&&v.update(a);C&&(m-=.01,0>m&&(m=0))};g.draw=function(a){if(t.loaded&&(D.setupContext(f),sb.draw(f),oc)){if(Y){for(var c in z){var d=z[c];d.tutorial||(d.setAlpha(m),d.draw(f,a))}for(c in z)d=z[c],d.tutorial||d.drawAfter(f,a);for(c in z)z[c].drawInfo(f);U.drawBehind(f)}Y&&(U.drawLayer2(f),U.draw(f),U.drawExplosions(f),Qb.draw(f),sb.drawLimits(f));
L&&B&&B.drawInput(f);0<ra&&this.drawOffscreenInfo(f,1);D.startUILayer();v.isInitialized&&v.draw(f);0<e&&!T&&t.keysImage&&(f.save(),f.globalAlpha=e,f.scale(s,s),f.translate(.5*ma/s,.825*Z/s),f.drawImage(t.keysImage,-t.keysImage.width/2,-t.keysImage.height/2),f.restore());0<b&&!T&&t.boostImage&&(f.save(),f.globalAlpha=b,f.scale(s,s),f.translate(.5*ma/s,.825*Z/s),f.drawImage(t.boostImage,-t.boostImage.width/2,-t.boostImage.height/2),f.restore());L&&Rb.draw(f);R.draw(f)}};g.updateOffscreenInfo=function(b){if(null!=
B){var a=D.getBounds(),c=a[1].x,e=a[0].x,f=a[0].y,g=a[1].y,k,m,a=Db((aa-qc)/Da,0,1);Ya=a*(vb-tb)+tb;Za=a*(wb-ub)+ub;pc!=ra&&(Ya=vb,Za=wb,tb=vb,ub=wb,pc=ra);k=Ya;m=Za;if(B&&!Ma(k,m,50)){var a=ea.x-k,v=(ea.y-m)/a,h=ea.y-v*ea.x;d[b].y=0>a?v*c+h:v*e+h;d[b].y<f?d[b].y=f:d[b].y>g&&(d[b].y=g);d[b].x=(d[b].y-h)/v;c=d[b].x-k;e=d[b].y-m;c=Math.sqrt(c*c+e*e);d[b].scale=1;300<c&&(d[b].scale=1-(c-300)/4E3,.5>d[b].scale&&(d[b].scale=.5));1<v?v=1:-1>v&&(v=-1);d[b].angle=Math.acos(v);0>a&&(d[b].angle+=Math.PI);d[b].outside=
!0}else d[b].outside=!1}};g.drawOffscreenInfo=function(b,a){if(B&&d[a].outside){b.save();b.translate(d[a].x,d[a].y);b.save();var c=dc(0,32,-d[a].angle);b.translate(c.x,c.y);b.scale(.5*d[a].scale,.5*d[a].scale);db()?t.frames.santa_hat.draw(b):t.frames.crown.draw(b);b.restore();b.rotate(-d[a].angle);b.translate(0,20);c=.9*d[a].scale;b.fillStyle="hsl(47, 100%, 70%)";b.beginPath();b.moveTo(-4*c,0);b.lineTo(4*c,0);b.lineTo(0,-10*c);b.fill();b.restore()}};g.gameCleanup=function(){B=void 0;L=!1;ob=0;for(id in z)delete z[id];
z={};qa.direction=1};var J;g.resize=function(b){A();n.hasConnection&&(J&&clearTimeout(J),J=setTimeout(n.sendResize,200))};g.clearSpeedupTutorial=function(){v.clear()};g.initSpeedupTutorial=function(){v.init()};g.fadeOutGame=function(){C=!0};g.resetAlpha=function(){C&&(C=!1,m=1)};var A=function(){var b=2;sa&&(b=1);k.width=1E3;k.height=700;ma=k.width;Z=k.height;var a=Z*b,c=-50+50*b+"%",c="translate("+c+","+c+") scale("+b+")";h("#canvas").css({transform:c});h("#canvas").css({"-ms-transform":c});h("#canvas").css({"-webkit-transform":c});
s=.92*Math.max(Z/850,ma/1500);s*=l.devicePixelRatio/Lb;za=Math.min(1,a/850);$a=!0;c=440*za;if(0<c){var d="translate(-50%,0%) scale("+za+")";h("#mainDialog").css({transform:d});h("#mainDialog").css({"-ms-transform":d});h("#mainDialog").css({"-webkit-transform":d});d="scale("+1/za+")";h("#mainMenuXpBar").css({transform:d});h("#mainMenuXpBar").css({"-ms-transform":d});h("#mainMenuXpBar").css({"-webkit-transform":d});a=a/2-.38*c;h("#mainDialog").css({top:a+"px"})}P&&(P.domElement.style.position="absolute",
P.domElement.style.left=.31*k.width*b+"px",P.domElement.style.top=k.height*b-18-30+"px");I&&(I.domElement.style.position="absolute",I.domElement.style.left=(.31*k.width-100/b)*b+"px",I.domElement.style.top=k.height*b-18-30+"px")};g.getMouseWorldPosition=function(){var b=1;sa||(b=2);return{x:(jc+(D.x*D.zoom-k.width*b/2))/D.zoom,y:(kc+(D.y*D.zoom-k.height*b/2))/D.zoom}};(function(){k=a;f=k.getContext("2d");g.context=f;A();sb=new hd;U=new ld;t=new Sc;t.load(c);myName="";D=new md(k,f,0,0);Rb=new jd;n=
new kd;n.getServerAndConnect();v=new nd;F=new od;F.load(function(){});r=new pd;M=new qd})()},md=function(a,c,g,d){var k=this;this.x=g;this.y=d;this.minZoom=1;this.maxZoom=2;this.zoom=this.minZoom;var f=0,e,b=0,v=0,m=0,h=0;this.setupContext=function(b){var c=k.zoom,d=a.width/2-k.x*c,e=a.height/2-k.y*c;b.setTransform(1,0,0,1,0,0);b.translate(d+m,e+h);b.scale(c,c)};this.applyShake=function(a){if(Y)if(0<f){var c=e;250>f&&(c=f/1E3/.5*e);b+=1;v+=1.1;var d=Math.sin(b)*(c/4),c=Math.cos(v)*c;m=d;h=c;f-=a}else h=
m=0};this.update=function(b){Y||(k.y=0);if(L||T){Pb&&(Ob=.6);pb+=(Ob-pb)/10;k.zoom=1/(l.devicePixelRatio/Lb)*pb*1;k.zoom*=s;var a=k.x,c=k.y;if(B&&!Xa)B.beingDeleted||(a=B.x,c=B.y),Y=!0,0>Q&&W.resetAlpha();else if(0<xb){var d=z[xb];d&&(a+=(d.x-a)/Aa,c+=(d.y-c)/Aa)}k.x=a;k.y=c;this.applyShake(b)}};this.setPosition=function(b,a){k.x=b;k.y=a};this.shake=function(b){Y&&(f=500,e=b)};this.getBounds=function(){return[{x:k.x-a.width/2/k.zoom,y:k.y-a.height/2/k.zoom},{x:k.x+a.width/2/k.zoom,y:k.y+a.height/
2/k.zoom}]};this.getOuterBounds=function(){return[{x:k.x-a.width/2/k.minZoom,y:k.y-a.height/2/k.minZoom},{x:k.x+a.width/2/k.minZoom,y:k.y+a.height/2/k.minZoom}]};this.getInnerBounds=function(){return[{x:k.x-a.width/2/k.maxZoom,y:k.y-a.height/2/k.maxZoom},{x:k.x+a.width/2/k.maxZoom,y:k.y+a.height/2/k.maxZoom}]};this.startUILayer=function(){c.setTransform(1,0,0,1,0,0)}},Ab=function(){this.width;this.height;var a,c,g,d,k=void 0;this.y=this.x=0;var f,e;this.canvas;this.frameWithCanvas=function(b,a,c){this.width=
b.width;this.height=b.height;this.canvas=b;f=a;e=c};this.setFrameInfo=function(b,v){k=v;a=b[1];c=b[2];this.width=b[3];this.height=b[4];g=b[5];d=b[6];f=-this.width*g;e=-this.height*d};this.draw=function(b){k?b.drawImage(k,a,c,this.width,this.height,f+this.x,e+this.y,this.width,this.height):b.drawImage(this.canvas,0,0,this.width,this.height,f+this.x,e+this.y,this.width,this.height)};this.renderTintedFrame=function(b){var d=y.createElement("canvas"),g=d.getContext("2d");d.width=this.width;d.height=this.height;
var h=y.createElement("canvas");h.width=this.width;h.height=this.height;var J=h.getContext("2d");J.fillStyle=b;J.fillRect(0,0,h.width,h.height);J.globalCompositeOperation="destination-atop";J.drawImage(k,a,c,this.width,this.height,0,0,this.width,this.height);g.globalAlpha=1;g.drawImage(h,0,0);b=new Ab;b.frameWithCanvas(d,f,e);return b};this.getImageCopy=function(){var b=y.createElement("canvas");b.width=this.width;b.height=this.height;var d=b.getContext("2d");d.drawImage(k,a,c,this.width,this.height,
0,0,this.width,this.height);var e=d.getImageData(0,0,this.width,this.height);return{canvas:b,ctx:d,toData:e.data,to:e}};this.generateTintImage2=function(b,d,g,h){var J=y.createElement("canvas");J.width=this.width;J.height=this.height;var l=J.getContext("2d");l.drawImage(k,a,c,this.width,this.height,0,0,this.width,this.height);for(var q=l.getImageData(0,0,this.width,this.height),w=q.data,r=w.length,n=0;n<r;)w[n]=w[n++]*(1-h)+b*h,w[n]=w[n++]*(1-h)+d*h,w[n]=w[n++]*(1-h)+g*h,w[n]=.8*w[n++];l.putImageData(q,
0,0);b=new Ab;b.frameWithCanvas(J,f,e);return b};this.generateTintImage=function(b,a,c,d){var g=y.createElement("canvas");g.width=this.width;g.height=this.height;var k=g.getContext("2d");k.globalAlpha=1;k.globalCompositeOperation="copy";k.drawImage(b[3],0,0);k.globalCompositeOperation="lighter";0<a&&(k.globalAlpha=a/255,k.drawImage(b[0],0,0));0<c&&(k.globalAlpha=c/255,k.drawImage(b[1],0,0));0<d&&(k.globalAlpha=d/255,k.drawImage(b[2],0,0));b=new Ab;b.frameWithCanvas(g,f,e);return b};this.generateRGBKs=
function(){var b=[],d=y.createElement("canvas");d.getContext("2d");d.width=this.width;d.height=this.height;d=y.createElement("canvas");d.width=this.width;d.height=this.height;d=d.getContext("2d");d.drawImage(k,a,c,this.width,this.height,0,0,this.width,this.height);for(var e=d.getImageData(0,0,this.width,this.height).data,f=e.length,g=this.getImageCopy(),h=this.getImageCopy(),q=this.getImageCopy(),d=this.getImageCopy(),l=0;l<f;l+=4)g.toData[l]=e[l],g.toData[l+1]=0,g.toData[l+2]=0,g.toData[l+3]=e[l+
3],h.toData[l]=0,h.toData[l+1]=e[l+1],h.toData[l+2]=0,h.toData[l+3]=e[l+3],q.toData[l]=0,q.toData[l+1]=0,q.toData[l+2]=e[l+2],q.toData[l+3]=e[l+3],d.toData[l]=0,d.toData[l+1]=0,d.toData[l+2]=0,d.toData[l+3]=e[l+3];g.ctx.putImageData(g.to,0,0);h.ctx.putImageData(h.to,0,0);q.ctx.putImageData(q.to,0,0);d.ctx.putImageData(d.to,0,0);e=new Image;e.src=g.canvas.toDataURL();g=new Image;g.src=h.canvas.toDataURL();h=new Image;h.src=q.canvas.toDataURL();q=new Image;q.src=d.canvas.toDataURL();b.push(e);b.push(g);
b.push(h);b.push(q);return b};this.renderToCanvas=function(){var b=y.createElement("canvas"),d=b.getContext("2d");b.width=this.width;b.height=this.height;var e=y.createElement("canvas");e.width=this.width;e.height=this.height;e.getContext("2d");k?d.drawImage(k,a,c,this.width,this.height,0,0,this.width,this.height):d.drawImage(this.canvas,0,0,this.width,this.height,0,0,this.width,this.height);d.globalAlpha=1;d.drawImage(e,0,0);return b}},ld=function(){var a={},c=[],g=[],d=[],k=[];this.addAnimationInfo=
function(c,d){a[c]=d};this.setAnimationInterval=function(c,d){a[c].setInterval(d)};this.createAnimation=function(c){c=a[c];var d=new Jc;d.setup(c);return d};this.runAnimation=function(a){c.push(a)};this.runAnimationLayer2=function(a){g.push(a)};this.runAnimationBehind=function(a){d.push(a)};this.addBlast=function(a,c,b,d,g){var k=U.createAnimation("explosion");k.setScale(b);k.posX=a;k.posY=c;U.runAnimationBehind(k);a=1-Cb(a,c,ea.x,ea.y)/PLAY_DISTANCE;.01<a&&F.playSound(SOUND_PLANE_EXPL,a*g,1,d,null)};
this.addExplosion=function(a,c,b,d){if(Ma(a,c,100)&&50>+new Date-aa){if(1>=k.length){var g=new sd;g.init(a,c,b,d);k.push(g)}this.addBlast(a,c,1,zc,1)}};this.update=function(a){for(var c in k){var b=k[c];b.update(a);b.deleting&&(k.splice(c,1),delete b)}};this.drawBehind=function(a){for(var c in d){var b=d[c];a.save();a.translate(b.posX,b.posY);a.scale(b.scaleX,b.scaleY);a.rotate(b.rotation);b.draw(a);a.restore()}};this.drawLayer2=function(a){for(var c in g){var b=g[c];a.save();a.translate(b.posX,b.posY);
a.scale(b.scaleX,b.scaleY);a.rotate(b.rotation);b.draw(a);a.restore()}};this.draw=function(a){for(var d in c){var b=c[d];a.save();a.translate(b.posX,b.posY);a.scale(b.scaleX,b.scaleY);a.rotate(b.rotation);b.draw(a);a.restore()}};this.drawExplosions=function(a){for(var c in k)k[c].draw(a)}},Jc=function(){var a=0,c=0,g=0;this.frames;this.frameCount=0;this.deleting=!1;this.posY=this.posX=0;this.scaleY=this.scaleX=1;this.rotation=0;this.alpha=1;this.copy=function(a){a=new Jc;a.frames=this.frames;a.frameCount=
this.frameCount;a.deleting=this.deleting;a.posX=this.posX;a.posY=this.posY;a.scaleX=this.scaleX;a.scaleY=this.scaleY;a.rotation=this.rotation;a.alpha=this.alpha;a.setInterval(c);return a};this.setup=function(a){c=a.interval;this.frames=a.frames;this.frameCount=a.frames.length};this.setInterval=function(a){c=a};this.update=function(d){this.deleting||(g>c&&(a++,g-=c),g+=d,a>=this.frameCount&&(this.deleting=!0))};this.setScale=function(a){this.scaleY=this.scaleX=a};this.draw=function(c){1>this.alpha&&
(c.globalAlpha=this.alpha);this.frames[a].draw(c)}};gameSheetInfo=[["crown",274,202,31,27,.5,.5],["food",2,132,100,100,.5,.5],["glow",132,2,98,98,.5,.505],["glow_hard",132,102,98,98,.5,.505],["grid",2,2,128,128,.5,.5],["head_dot",232,68,47,46,.5,.5],["lightning1",292,2,18,30,.5,.5],["lightning2",281,68,19,30,.526,.5],["lightning3",104,170,20,30,.5,.5],["lightning_glow",104,132,24,36,.5,.5],["particleDot",292,34,14,19,.5,.474],["santa_hat",232,160,41,38,.463,.513],["skullback",281,100,28,17,.5,.176],
["skullbase",275,160,35,40,.514,.5],["skulleyesblue",274,231,24,11,.5,.182],["skulleyesgreen",277,119,24,11,.5,.182],["skulleyesred",277,132,24,11,.5,.182],["skulleyesyellow",277,145,24,11,.5,.182],["skullglow",232,2,58,64,.5,.5],["skullgradient",104,202,35,40,.514,.5],["spark0",141,202,49,29,.51,.483],["spark1",192,202,41,29,.61,.483],["spark2",235,200,37,30,.432,.5],["trophy",232,116,43,42,.5,.5],["wall_stretch",2,234,40,1,.5,.5]];var td=function(){this.color={h:"61",s:"100%",l:"100%",a:1};this.rotation=
0;this.scale=1;this.pos={x:0,y:0};this.speed={x:0,y:0};this.time=0;this.used=this.active=!1;this.rotationSpeed=0;this.draw=function(a,c){a.save();a.translate(this.pos.x,this.pos.y);a.scale(this.scale,this.scale);a.rotate(this.rotation);a.translate(10,-2);a.globalAlpha=this.color.a;c.draw(a);a.restore()}},Fc=function(){var a=0,c=0,g=[],d=0;this.life=400;var k,f,e,b;this.debreeAge=0;this.alpha=1;this.particleFrame;this.enabled=!1;this.setEnabled=function(a){this.enabled||this.resetSystem();this.enabled=
a};this.init=function(h,m,l){d=h;b=e=f=k=0;a=m;c=l;for(h=0;h<d;h++)m=new td,this.resetParticle(m),m.active=!1,m.time=9999,g.push(m)};this.resetSystem=function(){for(var a=this.life/d,b=0;b<d;b++){var c=g[b];this.resetParticle(c);c.active=!1;c.time=a*b}};this.resetParticle=function(d){d.pos.x=a;d.pos.y=c;d.speed.x=e;d.speed.y=b;d.time=0;d.color.a=1;d.rotationSpeed=(Math.random()-.5)/10;d.rotation=360*Math.random()};this.update=function(a){a=1E3/60;for(var b=0;b<d;b++){var c=g[b];c.time>=this.life&&
(c.active||(c.active=!0,c.time%=this.life),this.enabled&&this.resetParticle(c));c.time+=a;if(c.active){var e=c.time/this.life;1<e&&(e=1);c.pos.x+=1*c.speed.x;c.pos.y+=1*c.speed.y;if(0<=e&&.1>e){var h=e/.1;c.scale=.4}else c.scale=.4+.3*(e-.1);c.rotation+=c.rotationSpeed;c.color.a=1;0<=e&&.1>e?(h=e/.1,c.color.a=h):.5<e&&(c.color.a=1-(e-.5)/.5);c.color.a*=this.alpha;c.speed.x+=1*k;c.speed.y+=1*f}}};this.setPosition=function(b,d){a=b;c=d};this.setLife=function(a){this.life=a};this.draw=function(a){for(var b=
d-1;0<=b;b--){var c=g[b];c.active&&c.draw(a,this.particleFrame)}}},sd=function(){function a(a){return Math.random()*a-a/2}this.deleting=!1;var c=[],g,d;this.init=function(c,f,e,b){g=c;d=f;c=2+4*Math.random();f=2+4*Math.random();var h=2+4*Math.random();Math.random();var m=Math.PI/4,l=a(Math.PI/2),r=a(m)+l,n=Math.cos(r),r=Math.sin(r),q=2/3*Math.PI+a(m)+l,w=Math.cos(q),q=Math.sin(q),l=4/3*Math.PI+a(m)+l,m=Math.cos(l),l=Math.sin(l);this.addDebree(n*c+e,r*c+b);this.addDebree(w*f+e,q*f+b);this.addDebree(m*
h+e,l*h+b)};this.addDebree=function(a,f){var e=new ud;e.init(g,d);e.setSpeed(a,f);c.push(e)};this.update=function(a){var d=0;for(debreeID in c){var e=c[debreeID];e.update(a);e.deleting&&(c.splice(debreeID,1),delete e);d++}0==d&&(this.deleting=!0)};this.draw=function(a){for(debreeID in c)c[debreeID].draw(a)}},ud=function(){var a,c,g,d,h,f=.08;gameEvent.isSpaceWars()&&(f=0);var e,b,l,m=0;this.deleting=!1;this.init=function(a,c){e=a;b=c;l=new Fc;l.init(15,e,b)};this.setSpeed=function(b,e){a=b;c=e;g=
0;d=.2*a;h=.2*c};this.update=function(r){g+=f;e+=a;b+=c+g;a*=.975;c*=.975;f*=.975;Math.abs(a)<Math.abs(d)&&(a=d);Math.abs(c)<Math.abs(h)&&(c=h);3<g&&(g=3);m+=r;500<m&&2300>=m?l.debreeAge=(m-500)/2300:2300<m&&2500>=m?l.alpha=(2500-m)/200:2500<m&&(delete l,this.deleting=!0);this.deleting||(l.setPosition(e,b),l.updateExplosion(r))};this.draw=function(a){this.deleting||l.draw(a)}},nd=function(){var a=this,c,g,d=0,h=0,f=0,e=8,b=-4,l=0,m=2,r=0,n=.5,t=0,q=15,w=[],s=99999,y,F,B=0,K=!1,D=!1,M=!1,H=0;this.isInitialized=
!1;a.buildFoodPacket=function(a){var b=new ArrayBuffer(100),b=new DataView(b),c=0;b.setFloat32(c,a.x,!0);c+=4;b.setFloat32(c,a.y,!0);a.isFull&&b.setUint16(c+4,a.hue,!0);return b};a.buildSnakePacket=function(a){var b=new ArrayBuffer(100),b=new DataView(b),c=0;b.setFloat32(c,a.x,!0);c+=4;b.setFloat32(c,a.y,!0);c+=4;b.setFloat32(c,a.lastLen,!0);c+=4;b.setFloat32(c,a.curLengthDst,!0);var c=c+4+1,d=a.pointCount;b.setUint16(c,d,!0);c+=2;b.setUint8(c,a.flags,!0);c+=1;a.flags&2&&(b.setFloat32(c,a.rubPoint.x,
!0),c+=4,b.setFloat32(c,a.rubPoint.y,!0),c+=4,b.setUint16(c,1,!0),c+=2);b.setUint8(c,0,!0);c+=1;b.setUint8(c,a.extraSpeed,!0);c+=1;if(a.isFull){for(var e=0;e<d;e++)b.setFloat32(c,a.points[e].x,!0),c+=4,b.setFloat32(c,a.points[e].y,!0),c+=4;b.setUint16(c,a.hue,!0);c+=2;b.setUint8(c,0,!0)}else for(d=a.newPointCount,b.setUint8(c,d,!0),c+=1,e=0;e<d;e++)b.setFloat32(c,a.newPoints[e].x,!0),c+=4,b.setFloat32(c,a.newPoints[e].y,!0),c+=4;return b};a.update=function(s){if(this.isInitialized&&!(100<s)){D&&(H+=
s,1E3<H&&(H=0,K=!0,D=!1));7==l&&K?(B-=.04,0>B&&(B=0,a.clear(),a.init(),nextTipID=0,La=!0)):(B+=.04,1<B&&(B=1));c.setAlpha(B);g.setAlpha(B);if(d>Da){if(void 0!=z[c.id])if(4<=l&&h>t){if(!M){M=!0;c.killReason=3;c.beingDeleted=!0;c.setDead();for(var x=0;20>x;x++){var E=t-30+1.5*x,F=.5*(Math.random()+.5),u=.3*(Math.random()-.5),E=this.initFood(E,0,295+50*Math.random());E.speedX=F;E.speedY=u}}}else h+=.5,u={},u.x=h,u.y=f,u.lastLen=2,u.curLengthDst=30,u.pointCount=2,u.flags=0,u.extraSpeed=0,u.isFull=!1,
u.newPointCount=0,u=this.buildSnakePacket(u),c.updateNetwork(u,0,!1);u={newPointCount:0};0==l&&(-2.6<b?(l=1,m++,u.newPointCount=1,u.newPoints=[],u.newPoints.push({x:e,y:b})):b+=.5);F=x=!1;if(1==l||3==l)if(e+=n,e<h-10&&1==l||e<h&&3==l)n+=.03,x=!0,5<n&&(n=5),r+=3,200<r&&(r=200),u.flags|=2,u.rubPoint={x:e-.06,y:f},F=!0;else if(e>=h-10&&1==l||e>=h+4)e-=n,1==l?l=2:(l=4,t=e),m++,u.newPointCount=1,u.newPoints=[],u.newPoints.push({x:e,y:b});x||(n-=.01,.5>n&&(n=.5),r-=1,0>r&&(r=0));if(2==l||4==l)2==l?-1.2<
b?(l=3,m++,u.newPointCount=1,u.newPoints=[],u.newPoints.push({x:e,y:b}),nextTipID=1,La=!0):b+=n:.8<b?(l=5,m++,u.newPointCount=1,u.newPoints=[],u.newPoints.push({x:e,y:b})):b+=n;5==l&&(e>h+12?(l=6,m++,u.newPointCount=1,u.newPoints=[],u.newPoints.push({x:e,y:b})):e+=n);6==l&&(1>b?(l=7,m++,u.newPointCount=1,u.newPoints=[],u.newPoints.push({x:e,y:b}),nextTipID=2,La=!0):b-=n);if(7==l){e-=n;for(var X=w.length,x=0;x<X;x++)E=w[x],g.x<E.x+30&&void 0!=z[E.id]&&!E.beingDeleted&&(E.beingDeleted=!0,E.beginGrabX=
E.x,E.beginGrabY=E.y,E.setKilledBy(g.id),q+=1.1)}u.x=e;u.y=b;u.lastLen=2;u.curLengthDst=q;u.pointCount=m;u.isFull=!1;u.extraSpeed=r;u=this.buildSnakePacket(u);g.updateNetwork(u,0,!1);F&&g.setRubSnakeID(y);X=w.length;for(x=0;x<X;x++)E=w[x],u={},E.speedX*=.9,E.speedY*=.9,u.x=E.x/10+E.speedX,u.y=-E.y/10+E.speedY,u.isFull=!1,u=this.buildFoodPacket(u),E.updateNetwork(u,0,!1);d-=Da}void 0!=z[c.id]&&c.update(s);void 0!=z[g.id]&&g.update(s);X=w.length;for(x=0;x<X;x++)void 0!=z[w[x].id]&&w[x].update(s);d+=
s}};a.draw=function(a){var b=1;sa||(b=2);var d=1.4/b;a.save();a.translate(ma/2-435*za/b,.5*Z-209*za/b);a.scale(d*za,d*za);for(var b=w.length,e=d=0;e<b;e++)void 0!=z[w[e].id]?w[e].draw(a):d++;20==d&&7==l&&(D=!0);void 0!=z[c.id]&&(c.drawAfter(a),c.drawAfter(a));void 0!=z[g.id]&&(g.drawAfter(a),g.drawAfter(a));a.restore()};a.initFood=function(a,b,c){var d={},e=new Ic;e.playSounds=!1;e.id=s++;e.tutorial=!0;d.x=a;d.y=b;d.isFull=!0;d.hue=c;a=this.buildFoodPacket(d);e.updateNetwork(a,0,!0);z[e.id]=e;w.push(e);
return e};a.initSnake=function(a){var d={};0==a?(c=new Ub,c.playSounds=!1,c.tutorial=!0,c.id=s++,z[c.id]=c,y=c.id,d.lastLen=2,d.curLengthDst=30,d.pointCount=2,d.flags=0,d.extraSpeed=0,d.isFull=!0,d.points=[],d.points.push({x:h,y:f}),h+=30,d.points.push({x:h,y:f}),d.x=h,d.y=f,d.hue=320,a=this.buildSnakePacket(d),c.updateNetwork(a,0,!0)):(g=new Ub,g.playSounds=!1,g.id=s++,z[g.id]=g,F=g.id,g.tutorial=!0,d.lastLen=2,d.curLengthDst=q,d.pointCount=2,d.flags=0,d.extraSpeed=0,d.isFull=!0,d.points=[],d.points.push({x:e,
y:b}),d.points.push({x:e,y:b}),d.x=e,d.y=b,d.hue=170,a=this.buildSnakePacket(d),g.updateNetwork(a,0,!0))};a.clear=function(){if(this.isInitialized){this.isInitialized=!1;void 0!=z[y]&&(z[y].cleanup(),delete z[y]);void 0!=z[F]&&(z[F].cleanup(),delete z[F]);for(var a=w.length,b=0;b<a;b++)void 0!=z[w[b].id]&&delete z[w[b].id]}};a.init=function(){f=h=0;e=8;b=-4;l=0;n=.5;t=r=0;q=15;s=99999;w=[];D=K=!1;H=0;M=!1;B=0;this.initSnake(0);this.initSnake(1);this.isInitialized=!0}},dd="crash",Zc="spark",cd="electroloop",
ad="lineloop",bd="lineloopfast",fd="foodgrab",Gc="turn",$=0,zc=3,ed=.2,$c=.6,Yc=1,Dc=.05,Wc=.8,Xc=1.4,gd=.15,Hc=.6,od=function(){this.sound;var a=!1,c={},g={achievement:[0,429.0249433106576],bonus:[2E3,405.6235827664398],crash:[4E3,804.0589569160996],electroloop:[6E3,1821.1791383219954,1],foodgrab:[9E3,461.2925170068021],king:[11E3,1294.5124716553291],leaderboard:[14E3,1268.1859410430843],levelup:[17E3,1151.9954648526075],lineloop:[2E4,2946.1224489795904,1],lineloopfast:[24E3,2E3,1],playerdeath:[27E3,
949.5464852607718],spark:[29E3,87.93650793650798],turn:[31E3,500],zapenemy:[33E3,1024.5804988662144],zapking:[36E3,1142.6530612244933]};this.load=function(c){this.sound=new Howl({urls:["sounds/out.ogg","sounds/out.m4a","sounds/out.mp3","sounds/out.ac3"],sprite:g,onload:function(){a=!0;c&&c()}})};this.playSound=function(d,h,f,e,b){if(a&&la&&1!=Va){h*=S;Y?T&&(h*=.3):h=0;var l=g[d];c[d]||(c[d]=0);0<e&&c[d]>=e||(this.sound.play(d,function(a){var c=F.sound._nodeById(a);c&&c.bufferSource&&(c.bufferSource.playbackRate.value=
f);F.sound.volume(h,a);b&&b(a)}),l=l[1],e!=$&&c[d]++,setTimeout(function(){e!=$&&c[d]--},l))}};this.stop=function(c){a&&c.stop()};this.setVolume=function(a){this.sound.volume(a)}},pd=function(){var a={zaps100:{name:"Expert Zapper",description:"Zap 100 snakes",xp:2500,totalProgress:100,icon:"expert_zapper.png",iconLocked:"expert_zapper_locked.png"},zaps500:{name:"Master Zapper",description:"Zap 500 snakes",xp:5E3,totalProgress:500,icon:"master_zapper.png",iconLocked:"master_zapper_locked.png"},zaps2500:{name:"Apex Zapper",
description:"Zap 2,500 snakes",xp:1E4,totalProgress:2500,icon:"apex_zapper.png",iconLocked:"apex_zapper_locked.png"},alive3m25:{name:"Survivor",description:"Survive at least 3 minutes in 25 different lives",xp:2500,totalProgress:25,icon:"survivor.png",iconLocked:"survivor_locked.png"},rub100:{name:"Light Speed",description:"Boost off 100 different snakes",xp:2E3,totalProgress:100,icon:"light_speed.png",iconLocked:"light_speed_locked.png"},leader25:{name:"Solid Snake",description:"Reach the top 5 in 25 different lives",
xp:2500,totalProgress:25,icon:"solid_snake.png",iconLocked:"solid_snake_locked.png"},peace5:{name:"Give Peace a Chance",description:"Reach the top 5 without zapping another snake",xp:1E3,totalProgress:1,icon:"give_peace_a_chance.png",iconLocked:"pacifist_locked.png"},peace1:{name:"Pacifist",description:"Earn the crown without zapping another snake",xp:3E3,totalProgress:1,icon:"pacifist.png",iconLocked:"give_peace_a_chance_locked.png"},king1m:{name:"Your Highness",description:"Hold the crown for 1 minute without losing it",
xp:2500,totalProgress:1,icon:"your_highness.png",iconLocked:"your_highness_locked.png"},king5m:{name:"Long May You Reign",description:"Hold the crown for 5 minutes without losing it",xp:5E3,totalProgress:1,icon:"long_may_you_reign.png",iconLocked:"long_may_you_reign_locked.png"},bestzaps25:{name:"Battlesnake",description:"Zap 25 snakes in one life",xp:3500,totalProgress:1,icon:"battlesnake.png",iconLocked:"battlesnake_locked.png"},score5000:{name:"Overpowered",description:"Score 5,000 in one life",
xp:1E3,totalProgress:1,icon:"overpowered.png",iconLocked:"overpowered_locked.png"},score7500:{name:"Shock and Awe",description:"Score 7,500 in one life",xp:2500,totalProgress:1,icon:"shock_and_awe.png",iconLocked:"shock_and_awe_locked.png"},score10000:{name:"Resistance is Futile",description:"Score 10,000 in one life",xp:5E3,totalProgress:1,icon:"resistance_is_futile.png",iconLocked:"resistance_is_futile_locked.png"},session30m:{name:"Snake It 'Til You Make It",description:"Live as a snake in the same game for 30 minutes, across any number of lives",
xp:1E3,totalProgress:1,icon:"snake_it_til_you_make_it.png",iconLocked:"snake_it_til_you_make_it_locked.png"},food1000:{name:"Bit Snack",description:"Eat 1,000 bits",xp:1E3,totalProgress:1E3,icon:"bit_snack.png",iconLocked:"bit_snack_locked.png"},food10000:{name:"Bit Supper",description:"Eat 10,000 bits",xp:2E3,totalProgress:1E4,icon:"bit_supper.png",iconLocked:"bit_supper_locked.png"},food100000:{name:"Bit Buffet",description:"Eat 100,000 bits",xp:5E3,totalProgress:1E5,icon:"bit_buffet.png",iconLocked:"bit_buffet_locked.png"},
food1000000:{name:"Bit Feast",description:"Eat 1,000,000 bits",xp:1E4,totalProgress:1E6,icon:"bit_feast.png",iconLocked:"bit_feast_locked.png"}},c={alive1m:{name:"Survive 1 Min.",xp:50},alive2m:{name:"Survive 2 Min.",xp:100},alive3m:{name:"Survive 3 Min.",xp:150},alive4m:{name:"Survive 4 Min.",xp:200},alive5m:{name:"Survive 5 Min.",xp:250},zap:{name:"Zapped #PLAYERNAME",xp:50},zapking:{name:"Royal Flush",xp:500},rubkill:{name:"Power Move",xp:30},zap2:{name:"Double Zap",xp:100},zap3:{name:"Triple Zap",
xp:200},zap4:{name:"Ultra Zap",xp:300},"zap5+":{name:"MONSTER ZAP",xp:500},king:{name:"Coronation",xp:750},leader:{name:"On the Leaderboard",xp:100},narrowescape:{name:"Close Call",xp:10},speedmax:{name:"Light Speed",xp:50},boost5s:{name:"Boosted 5s",xp:10},boost15s:{name:"Boosted 15s",xp:30},boost30s:{name:"Boosted 30s",xp:60}},g={"zaped10s-":{name:"Zapped in 10 Seconds",xp:50},suicide:{name:"Zap Yourself",xp:50},suicideking:{name:"Zap Yourself with Crown",xp:100},zaps0:{name:"Zapless",xp:20},zappedwall:{name:"Hit the Wall",
xp:10},food0:{name:"No Bits for You",xp:20}},d=[3E3,4E3,4500,5E3,5500,6E3,6240,6489.6,6749.184,7019.15136,7299.9174144,7591.914110976,7895.5906754151,8211.4143024317,8539.8708745289,8881.4657095101,9236.7243378905,9606.1933114061,9990.4410438623,10390.0586856168,10805.6610330415,11237.8874743632,11687.4029733377,12154.8990922712,12641.095055962,13146.7388582005,13672.6084125285,14219.5127490297,14788.2932589909,15379.8249893505,15995.0179889245,16634.8187084815,17300.2114568208,17992.2199150936,18711.9087116974,
19460.3850601652,20238.8004625719,21048.3524810747,21890.2865803177,22765.8980435304,23676.5339652717,24623.5953238825,25608.5391368378,26632.8807023113,27698.1959304038,28806.1237676199,29958.3687183247,31156.7034670577,32402.97160574,33699.0904699696,35047.0540887684,36448.9362523192,37906.8937024119,39423.1694505084,41000.0962285288,42640.1000776699,44345.7040807767,46119.5322440078,47964.3135337681,49882.8860751188,51878.2015181236,53953.3295788485,56111.4627620025,58355.9212724826,60690.1581233819,
63117.7644483171,65642.4750262498,68268.1740272998,70998.9009883918,73838.8570279275,76792.4113090446,79864.1077614064,83058.6720718627,86381.0189547372,89836.2597129267,93429.7101014437,97166.8985055015,101053.574445722,105095.71742355,109299.546120492,113671.527965312,118218.389083925,122947.124647282,127865.009633173,132979.6100185,138298.79441924,143830.746196009,149583.97604385,155567.335085604,161790.028489028,168261.629628589,174992.094813733,181991.778606282,189271.449750533,196842.307740555,
204716.000050177,212904.640052184,221420.825654271],h;for(h=1;h<d.length;h++)d[h]+=d[h-1];var f=0,e=0,b=0,n=0,m=0,t=0,s=0,A=0,q=0,w=0,y=0,z=0,B=0,D=0,K=0,na=new Map,I=new Map,H=new Map,G=null,x=null;this.currentGameDuration=function(){return Date.now()-s};this.currentLevel=function(){return K};this.isMaxLevel=function(a){return a>=d.length};this.xpInCurrentLevel=function(){return 0>=K?D:D-d[K-1]};this.totalXpToLevelUp=function(a){return a>=d.length?0:d[a]-(0<a?d[a-1]:0)};this.allAchievementsIds=function(){return Object.keys(a)};
this.achievementInfo=function(b){return a[b]};this.achievementCurrentProgress=function(b){var c;switch(b){case "alive3m25":c=this.currentProgressStayinAliveAchievement();break;case "leader25":c=this.currentProgressHighRankAchievement();break;case "peace5":case "peace1":c=this.currentProgressPacifistAchievement(b);break;case "zaps100":case "zaps500":case "zaps2500":c=this.currentProgressKillsAchievement();break;case "food1000":case "food10000":case "food100000":case "food1000000":c=this.currentProgressFoodEatenAchievement();
break;case "rub100":c=this.currentProgressRubbingAchievement();break;case "king1m":case "king5m":c=this.currentProgressCrownTimeAchievement(b);break;case "score5000":case "score7500":case "score10000":c=this.currentProgressBestScoreAchievement(b);break;case "session30m":c=this.currentProgressGameSessionAchievement();break;case "bestzaps25":c=this.currentProgressBestKillsAchievement();break;default:c=0}0<c&&(c=Math.min(c,a[b].totalProgress));return c};this.allBonusesIds=function(){return Object.keys(c)};
this.bonusInfo=function(a){return c[a]};this.allPenaltiesIds=function(){return Object.keys(g)};this.penaltyInfo=function(a){return g[a]};this.lastGameStats=function(){return G};this.signalGameStart=function(){0==s&&(t=m=n=b=e=f=0,s=Date.now(),A=0,this.readStats(),na.clear(),I.clear(),H.clear(),G=null,this.setupStayinAliveAchievement(),this.setupPacifistAchievement(),this.setupRubbingAchievement(),this.setupCrownTimeAchievement(),this.setupGameSessionAchievement(),this.setupStayAliveBonus(),this.setupZapStreakBonus(),
this.setupCloseCallBonus(),this.setupLightSpeedBonus(),this.setupBoostBonus(),this.setupRubKillBonus(),x=setTimeout(this.saveStatsPeriodically,1E4),M.updateMainMenuLevel(),M.updateMainMenuXpBar(),M.updateStatsPageLevel(),M.updateStatsPageXpBar())};this.signalWasKilled=function(a){if(0!=s){0>=f&&(e=f=q);clearTimeout(x);x=null;this.cleanupStayinAliveAchievement();this.cleanupCrownTimeAchievement();this.cleanupGameSessionAchievement();this.cleanupStayAliveBonus();this.cleanupBoostBonus();null!==a&&(this.checkGetZappedPenalty(a),
this.checkKillsPenalty(),this.checkFoodEatenPenalty());A+=m;D+=m;0>A?(D-=A,A=0):this.updateLevel();this.saveStats();var c=Date.now()-s;s=0;G={gameScore:m,gameFoodEaten:b,gameKills:n,gameBestRank:e,gameXp:A,gameAchievements:na,gameBonuses:I,gamePenalties:H,gameTime:c,killReason:2==a.killReason?2:3==a.killReason||a.killedByID==a.id?3:1};0<A&&(M.updateMainMenuLevel(),M.updateMainMenuXpBar());M.updateStatsPage();M.updateAchievementsPage();F.playSound("playerdeath",.2*S,1,$,null)}};this.signalFoodEaten=
function(){0!=s&&(b++,w++,this.checkFoodEatenAchievement())};this.signalEnemyKilledByPlayer=function(a,b){0!=s&&(n++,y++,F.playSound("zapenemy",.2*S,1,$,null),this.checkKillsAchievement(),this.checkZapBonus(b),this.checkRubKillBonus(a),n<=z||(this.checkBestKillsAchievement(n,z),z=n))};this.signalKingKilledByPlayer=function(){this.checkZapKingBonus()};this.signalUpdateRank=function(a){q=a;0==s||0>=a||a==f||(f=a,this.checkCrownTimeAchievement(a),a>=e&&0!=e||(this.checkHighRankAchievement(a,e),this.checkPacifistAchievement(a),
this.checkNewBestRankBonus(a,e),e=a))};this.signalUpdateScore=function(a){0==s||0>=a||a==m||(m=a,a<=t||(t=a,a<=B||(this.checkBestScoreAchievement(a,B),B=a)))};this.signalBoostState=function(a){0!=s&&this.checkBoostBonus(a)};this.signalRubbingOnEnemyState=function(a,b){0!=s&&(this.updateRubKillBonus(a),this.checkCloseCallBonus(b),this.checkRubbingAchievement(a))};this.signalMaxSpeedReached=function(){this.checkLightSpeedBonus()};this.unlockAchievement=function(b){if(0!=s){var c=a[b];A+=c.xp;D+=c.xp;
var d=na.get(b);d?d++:d=1;na.set(b,d);this.saveStats();M.showAchievementNotification(c)}};this.awardBonus=function(a,b){if(0!=s){var d=c[a];A+=d.xp;D+=d.xp;var e=I.get(a);e?e++:e=1;I.set(a,e);b||(b=d.name);R.addSpecialMessage(b+" +"+O(d.xp)+"XP",40);switch(a){case "zap":case "rubkill":case "zap2":case "zap3":case "zap4":case "zap5+":break;case "zapking":F.playSound("zapking",.5*S,1,$,null);break;case "king":F.playSound("king",.3*S,1,$,null);break;case "leader":F.playSound("leaderboard",.3*S,1,$,null);
break;default:F.playSound("bonus",.2*S,1,$,null)}}};this.applyPenalty=function(a){if(0!=s){var b=Math.abs(g[a].xp);A-=b;D-=b;(b=H.get(a))?b++:b=1;H.set(a,b)}};this.updateLevel=function(){for(;K<d.length&&D>=d[K];)K++};this.readStats=function(){w=this.getStoredInt(E,0);y=this.getStoredInt(N,0);z=this.getStoredInt(u,0);B=this.getStoredInt(X,0);D=this.getStoredInt(ja,0)};this.saveStats=function(){null!=x&&(clearTimeout(x),x=setTimeout(r.saveStatsPeriodically,1E4));r.setStoredInt(N,y);r.setStoredInt(u,
z);r.setStoredInt(E,w);r.setStoredInt(X,B);r.setStoredInt(ja,D)};this.saveStatsPeriodically=function(){x=null;r.saveStats();x=setTimeout(r.saveStatsPeriodically,1E4)};var E="PrgLFE",N="PrgLK",u="PrgLBK",X="PrgLBS",ja="PrgLX";this.getStoredInt=function(a,b){var c=l.localStorage.getItem(a);return c?parseInt(c):b};this.setStoredInt=function(a,b){l.localStorage.setItem(a,String(b))};var ba=null;this.setupStayinAliveAchievement=function(){this.cleanupStayinAliveAchievement();ba=setTimeout(function(){var a=
r.getStoredInt("PrgSAAT",0);a++;r.setStoredInt("PrgSAAT",a);25==a&&r.unlockAchievement("alive3m25");ba=null},18E4)};this.cleanupStayinAliveAchievement=function(){null!==ba&&(clearTimeout(ba),ba=null)};this.currentProgressStayinAliveAchievement=function(){return this.getStoredInt("PrgSAAT",0)};this.checkHighRankAchievement=function(a,b){if(5>=a&&(5<b||0>=b)){var c=this.getStoredInt("PrgLAT",0);c++;this.setStoredInt("PrgLAT",c);25==c&&this.unlockAchievement("leader25")}};this.currentProgressHighRankAchievement=
function(){return this.getStoredInt("PrgLAT",0)};var ka=[{id:"peace5",rank:5},{id:"peace1",rank:1}],ca=0;this.setupPacifistAchievement=function(){ca=this.getStoredInt("PrgPABR",0)};this.checkPacifistAchievement=function(a){0==n&&(a<ca||0==ca)&&(ka.forEach(function(b,c,d){c=ca<=b.rank&&0!=ca;a<=b.rank&&!c&&r.unlockAchievement(b.id)}),ca=a,this.setStoredInt("PrgPABR",ca))};this.currentProgressPacifistAchievement=function(a){var b;for(b=0;b<ka.length;b++){var c=ka[b];if(c.id==a){a=this.getStoredInt("PrgPABR",
0);if(0!=a&&a<=c.rank)return 1;break}}return 0};var T=[{id:"zaps100",kills:100},{id:"zaps500",kills:500},{id:"zaps2500",kills:2500}];this.checkKillsAchievement=function(){T.forEach(function(a,b,c){y==a.kills&&r.unlockAchievement(a.id)})};this.currentProgressKillsAchievement=function(){return this.getStoredInt(N,0)};var U=[{id:"food1000",food:1E3},{id:"food10000",food:1E4},{id:"food100000",food:1E5},{id:"food1000000",food:1E6}];this.checkFoodEatenAchievement=function(){U.forEach(function(a,b,c){w==
a.food&&r.unlockAchievement(a.id)})};this.currentProgressFoodEatenAchievement=function(){return this.getStoredInt(E,0)};var W=[{id:"rub100",rubs:100}],P=0,Q=null,L=0,oa=new Set;this.setupRubbingAchievement=function(){P=this.getStoredInt("PrgRAER",0);Q=null;L=0};this.checkRubbingAchievement=function(a){0!=L&&Date.now()>L+1E3&&(oa.add(a),L=0,P++,this.setStoredInt("PrgRAER",P),W.forEach(function(a,b,c){P==a.rubs&&r.unlockAchievement(a.id)}));a!=Q&&(null===a?(Q=null,L=0):(Q=a,L=oa.has(a)?0:Date.now()))};
this.currentProgressRubbingAchievement=function(){return this.getStoredInt("PrgRAER",0)};var V=[{id:"king5m",time:3E5},{id:"king1m",time:6E4}],aa=!1,va=0,Ha=[];this.setupCrownTimeAchievement=function(){this.cleanupCrownTimeAchievement();va=this.getStoredInt("PrgCTAAW",0)};this.cleanupCrownTimeAchievement=function(){Ha.forEach(clearTimeout);Ha.length=0;aa=!1};this.checkCrownTimeAchievement=function(a){1!=a?aa&&this.cleanupCrownTimeAchievement():(aa=!0,V.forEach(function(a,b,c){va<a.time&&(b=setTimeout(function(){r.unlockAchievement(a.id);
va=a.time;r.setStoredInt("PrgCTAAW",va);Ha.length--},a.time),Ha.push(b))}))};this.currentProgressCrownTimeAchievement=function(a){var b;for(b=0;b<V.length;b++){var c=V[b];if(c.id==a){if(this.getStoredInt("PrgCTAAW",0)>=c.time)return 1;break}}return 0};var Ia=[{id:"score5000",score:5E3},{id:"score7500",score:7500},{id:"score10000",score:1E4}];this.checkBestScoreAchievement=function(a,b){Ia.forEach(function(c,d,e){d=b>=c.score;a>=c.score&&!d&&r.unlockAchievement(c.id)})};this.currentProgressBestScoreAchievement=
function(a){var b;for(b=0;b<Ia.length;b++){var c=Ia[b];if(c.id==a){if(this.getStoredInt(X,0)>=c.score)return 1;break}}return 0};var ua=0,pa=0,Y=null;this.setupGameSessionAchievement=function(){pa=this.getStoredInt("PrgGSALT",0);18E5>pa&&(Y=setTimeout(function(){r.unlockAchievement("session30m");pa=18E5;r.setStoredInt("PrgGSALT",pa);Y=null},18E5-ua))};this.cleanupGameSessionAchievement=function(){ua+=this.currentGameDuration();ua>pa&&(pa=ua,this.setStoredInt("PrgGSALT",pa));null!==Y&&(clearTimeout(Y),
Y=null)};this.currentProgressGameSessionAchievement=function(){return 18E5<=this.getStoredInt("PrgGSALT",0)?1:0};this.checkBestKillsAchievement=function(a,b){25<=a&&!(25<=b)&&r.unlockAchievement("bestzaps25")};this.currentProgressBestKillsAchievement=function(){return 25<=this.getStoredInt(u,0)?1:0};var da=[{id:"alive5m",time:3E5},{id:"alive4m",time:24E4},{id:"alive3m",time:18E4},{id:"alive2m",time:12E4},{id:"alive1m",time:6E4}],ea=[];this.setupStayAliveBonus=function(){this.cleanupStayAliveBonus();
da.forEach(function(a,b,c){b=setTimeout(function(){r.awardBonus(a.id);ea.length--},a.time);ea.push(b)})};this.cleanupStayAliveBonus=function(){ea.forEach(clearTimeout);ea.length=0};var ga=0,la=0;this.setupZapStreakBonus=function(){la=ga=0};this.checkZapBonus=function(a){this.awardBonus("zap","Zapped "+a);a=Date.now();if(a>la+5E3)ga=1;else switch(ga++,ga){case 2:this.awardBonus("zap2");break;case 3:this.awardBonus("zap3");break;case 4:this.awardBonus("zap4");break;default:this.awardBonus("zap5+")}la=
a};this.checkZapKingBonus=function(){this.awardBonus("zapking")};this.checkNewBestRankBonus=function(a,b){5>=a&&(5<b||0>=b)&&this.awardBonus("leader");1==a&&this.awardBonus("king")};var ia=!1;this.setupCloseCallBonus=function(){ia=!1};this.checkCloseCallBonus=function(a){if(!ia)null!==a&&4>a&&(ia=!0,setTimeout(function(){r.awardBonus("narrowescape")},500));else if(null===a||4<a)ia=!1};var ma=!1;this.setupLightSpeedBonus=function(){ma=!1};this.checkLightSpeedBonus=function(){ma||(ma=!0,this.awardBonus("speedmax"))};
var sa=[{id:"boost30s",time:3E4},{id:"boost15s",time:15E3},{id:"boost5s",time:5E3}],ha=!1,qa=0,fa=[],Z=null;this.setupBoostBonus=function(){this.cleanupBoostBonus();ha=!1;qa=0};this.cleanupBoostBonus=function(){null!==Z&&(clearTimeout(Z),Z=null);fa.forEach(clearTimeout);fa.length=0};this.checkBoostBonus=function(a){a&&!ha?(ha=!0,null!==Z?(clearTimeout(Z),Z=null):sa.forEach(function(a,b,c){qa<a.time&&(b=setTimeout(function(){r.awardBonus(a.id);qa=a.time;fa.length--},a.time+500),fa.push(b))})):!a&&
ha&&(ha=!1,Z=setTimeout(function(){Z=null;fa.forEach(clearTimeout);fa.length=0},500))};var ra=null,ta=0;this.setupRubKillBonus=function(){ra=null};this.updateRubKillBonus=function(a){null!==a&&(ra=a,ta=Date.now())};this.checkRubKillBonus=function(a){ra===a&&Date.now()<=ta+1E3&&r.awardBonus("rubkill")};this.checkGetZappedPenalty=function(a){Date.now()<s+1E4&&this.applyPenalty("zaped10s-");2==a.killReason?this.applyPenalty("zappedwall"):a.killedByID==a.id&&(this.applyPenalty("suicide"),1==f&&this.applyPenalty("suicideking"))};
this.checkKillsPenalty=function(){0>=n&&this.applyPenalty("zaps0")};this.checkFoodEatenPenalty=function(){0>=b&&this.applyPenalty("food0")};this.readStats();this.updateLevel();l.localStorage.removeItem("bestLength");l.localStorage.removeItem("bestKillStreak");l.localStorage.removeItem("bestTop")},qd=function(){var a=!1,c=[];this.showAchievementNotification=function(b){a?c.push(b):g(b)};var g=function(b){a=!0;h("#achievementNotification .achievementName")[0].innerText=b.name;h("#achievementNotification .achievementDesc")[0].innerText=
b.description;h("#achievementNotification .achievementIcon")[0].src="images/achievements/"+b.icon;h("#achievementNotification").fadeIn(500,function(){setTimeout(d,3E3)});F.playSound("achievement",.3*S,1,$,null)},d=function(){h("#achievementNotification").fadeOut(500,function(){if(0<c.length){var b=c.shift();g(b)}else a=!1})},k=h("#mainMenuLevel")[0],f=h("#endScreenLevel")[0],e=h("#endScreenLevelFrame")[0],b=h("#endScreenLevelParticles")[0],l=h("#mainMenuXpBarDiv")[0],m=h("#endScreenXpBarDiv")[0],
n=h("#mainMenuXpBarParticles")[0],s=h("#endScreenXpBarParticles")[0],t=e.width,q=e.height,w=[b.src,b.src+"?a=0"],y=1;b.src=w[1];var z=0,B=0,D=0,K=0,I=1,L=0;this.updateMainMenuLevel=function(){k.innerText=r.currentLevel()+1};this.updateStatsPageLevel=function(){I=r.currentLevel();f.innerText=I+1};this.updateMainMenuXpBar=function(){var a=r.xpInCurrentLevel();this.animateXpBarFromTo(l,n,r.currentLevel(),a,a,null)};this.updateStatsPageXpBar=function(){L=r.xpInCurrentLevel();this.animateXpBarFromTo(m,
s,r.currentLevel(),L,L,null)};this.animateMainMenuXpBar=function(){this.animateXpBarFromTo(l,n,r.currentLevel(),0,r.xpInCurrentLevel(),null)};this.animateStatsPageLevelAndXpBar=function(){if(!r.isMaxLevel(I)){var a=r.currentLevel(),c=r.xpInCurrentLevel(),d=I,g=L,k=r.totalXpToLevelUp(I);I<a?(I++,L=0,this.animateXpBarFromTo(m,s,d,g,k,function(){0==z&&(z=parseInt(f.style.fontSize.replace("px","")));b.src=w[y];y=(y+1)%w.length;h(b).show();h(e).animate({width:1.5*t+"px",height:1.5*q+"px"},400,"swing");
h(f).animate({fontSize:2*z+"px"},400,"swing",function(){f.innerText=I+1;h(e).animate({width:t+"px",height:q+"px"},400,"swing");h(b).fadeOut(400);h(f).animate({fontSize:z+"px"},400,"swing",function(){f.innerText=I+1;h(b).hide();M.animateStatsPageLevelAndXpBar()})});M.isShowingStatsPage()&&F.playSound("levelup",.2*S,1,$,null)})):I==a&&L<c&&(L=c,this.animateXpBarFromTo(m,s,d,g,c,null))}};this.animateXpBarFromTo=function(a,b,c,d,e,f){0==K&&(B=74,D=h("#mainMenuXpBarImg")[0].width,K=D-B);var g;g=r.isMaxLevel(c)?
e:r.totalXpToLevelUp(c);c=d/g;a.style.maxWidth=B+K*c+"px";h(b).hide();e==d?f&&f():(e/=g,d=B+K*e,c=e-c,e=1E3+500*c,h(a).animate({maxWidth:d+"px"},e,"swing",f),.1<=c&&h(b).fadeIn(200).delay(e-400).fadeOut(200))};var H=null;this.updateStatsPage=function(){var a;if(null===H){var b=h("#statsPage .endScreenStatsDetails"),c=b[0],d=c.parentNode;H=[c];for(a=1;a<b.length;a++)H.push(b[a]);for(;2>a;a++)c=c.cloneNode(!0),d.appendChild(c),H.push(c)}var e=r.lastGameStats();this.closeStatsPageDetails();h("#endScreenScore")[0].innerText=
O(e.gameScore);h("#endScreenKills")[0].innerText=O(e.gameKills);h("#endScreenRank")[0].innerText=e.gameBestRank;var f=function(a,b,c,d,e){b<a.length?b=a[b]:(b=a[0].cloneNode(!0),a[0].parentNode.appendChild(b));b.querySelector(".endScreenStatLineLeft").innerText=c;b.querySelector(".endScreenStatLineRight").innerText=O(e?d:-Math.abs(d));e?(b.classList.remove("endScreenStatLineNegative"),b.classList.add("endScreenStatLinePositive")):(b.classList.remove("endScreenStatLinePositive"),b.classList.add("endScreenStatLineNegative"));
h(b).show()},g=0,k=h(H[0]).find(".endScreenStatLine"),l=0,m=h(H[1]).find(".endScreenStatLine");k.hide();m.hide();var n=0,q=0,s=0;0<e.gameBonuses.size&&r.allBonusesIds().forEach(function(a,b,c){if(b=e.gameBonuses.get(a))switch(c=r.bonusInfo(a),a){case "zap":n+=b*c.xp;break;case "leader":q+=b*c.xp;break;default:s+=b*c.xp,f(k,g,c.name,b*c.xp,!0),g++}});var t=0;0<e.gamePenalties.size&&r.allPenaltiesIds().forEach(function(a,b,c){if(b=e.gamePenalties.get(a))a=r.penaltyInfo(a),t+=b*Math.abs(a.xp),f(k,g,
a.name,b*a.xp,!1),g++});h("#endScreenKillsXp")[0].innerText=O(n);h("#endScreenRankXp")[0].innerText=O(q);0<s||0<t?(a=0>=t?"BONUSES":0>=s?"PENALTIES":"BONUSES &amp; PENALTIES",h("#endScreenBonusStatLineLabel")[0].innerHTML=a,h("#endScreenBonusStatLineXp")[0].innerText=O(s-t),H[0].querySelector(".endScreenStatsDetailsTotal").innerText=O(s-t),h("#endScreenBonusStatLine").show()):h("#endScreenBonusStatLine").hide();if(0<e.gameAchievements.size){var v=0;r.allAchievementsIds().forEach(function(a,b,c){if(b=
e.gameAchievements.get(a))a=r.achievementInfo(a),v+=b*a.xp,f(m,l,a.name,b*a.xp,!0),l++});h("#endScreenAchievementsStatLineXp")[0].innerText=O(v);H[1].querySelector(".endScreenStatsDetailsTotal").innerText=O(v);h("#endScreenAchievementsStatLine").show()}else h("#endScreenAchievementsStatLine").hide();h("#endScreenTotalXp")[0].innerText=O(e.gameXp)};this.openStatsPage=function(){var a=r.lastGameStats(),b="COLLIDED",c="";1==a.killReason?(b="ZAPPED BY",c=ic):3==a.killReason&&(b="ZAPPED YOURSELF");h("#endScreenMessage")[0].innerText=
b;h("#endScreenMessageKiller")[0].innerText=c;h("#statsPage").show();setTimeout(function(){M.animateStatsPageLevelAndXpBar()},500)};this.closeStatsPage=function(){h("#statsPage").hide();this.closeStatsPageDetails()};this.isShowingStatsPage=function(){return h("#statsPage").is(":visible")};this.openStatsPageDetails=function(a){this.closeStatsPageDetails();if(H&&a<H.length){var b;switch(a){case 0:b=h("#endScreenBonusStatLine")[0];break;case 1:b=h("#endScreenAchievementsStatLine")[0]}b.classList.add("endScreenStatLineExpanded");
h(H[a]).show()}};this.closeStatsPageDetails=function(){h("#statsPage .endScreenStatLineExpanded").removeClass("endScreenStatLineExpanded");h("#statsPage .endScreenStatsDetails").hide()};var G=null,x=0,E=0,N=0;this.updateAchievementsPage=function(){var a,b=r.allAchievementsIds();if(null===G){var c=h("#achievementsPage .achievementCard"),d=c[0],e=d.parentNode;G=[d];x=parseInt(d.querySelector(".achievementProgressSlider").style.width.replace("px",""));E=parseInt(d.querySelector(".achievementProgressHolder").style.width.replace("px",
""));N=E-x;for(a=1;a<c.length;a++)G.push(c[a]);for(;a<b.length;a++)d=d.cloneNode(!0),e.appendChild(d),G.push(d)}for(a=c=0;a<b.length;a++){var f=b[a],e=r.achievementInfo(f),d=G[a];d.querySelector(".achievementName").innerText=e.name;d.querySelector(".achievementDesc").innerText=e.description;f=r.achievementCurrentProgress(f);if(f>=e.totalProgress)c++,d.classList.remove("achievementCardLocked"),d.classList.add("achievementCardUnlocked"),d.querySelector(".achievementIcon").src="images/achievements/"+
e.icon,h(d.querySelector(".achievementProgressHolder")).hide();else if(d.classList.remove("achievementCardUnlocked"),d.classList.add("achievementCardLocked"),d.querySelector(".achievementIcon").src="images/achievements/"+e.iconLocked,1<e.totalProgress){h(d.querySelector(".achievementProgressHolder")).show();var g=d.querySelector(".achievementProgressSlider");0>=f?h(g).hide():(g.style.width=x+f/e.totalProgress*N+"px",h(g).show());d.querySelector(".achievementProgressText").innerText=O(f)+" / "+O(e.totalProgress)}else h(d.querySelector(".achievementProgressHolder")).hide()}h("#achievementsEarned")[0].innerText=
c+" of "+b.length+" Earned"};this.openAchievementsPage=function(){h("#achievementsPage").fadeIn(500)};this.closeAchievementsPage=function(){h("#achievementsPage").fadeOut(500)};this.updateMainMenuLevel();this.updateAchievementsPage()};l.onload=function(){Rc();if(Modernizr.canvas&&Modernizr.websockets){null==W&&(l.devicePixelRatio&&(Lb=1<l.devicePixelRatio?2:1),W=new rd(y.getElementById("canvas")),l.addEventListener("resize",W.resize,!1),qa=new Tc,qa.addListeners(),l.requestAnimationFrame?l.requestAnimationFrame(Tb):
setInterval(Tb,1E3/60),h("#overlay").show());W.resize();var a="LOW";sa&&(a="HIGH");var c=h("#graphicsID")[0];c&&(c.childNodes[0].data="GRAPHICS: "+a)}else N&&console.log("unsupported-browser!")}})(window,document,jQuery);

</script>

</body>

<!-- Mirrored from powerline.coolmathgames.com/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 08 Oct 2024 22:05:51 GMT -->
</html>
